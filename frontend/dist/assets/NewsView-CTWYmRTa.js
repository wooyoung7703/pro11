var Ee=Object.defineProperty;var Pe=(h,n,v)=>n in h?Ee(h,n,{enumerable:!0,configurable:!0,writable:!0,value:v}):h[n]=v;var Me=(h,n,v)=>Pe(h,typeof n!="symbol"?n+"":n,v);import{j as Ve,k as m,d as He,c as F,m as Ue,l as Oe,P as qe,a as o,e as i,b as t,f as g,n as P,t as p,A as c,p as D,E as ze,q as Se,i as K,v as Ce,F as ie,r as ue,B as Fe}from"./index-BtrOmqR2.js";import M from"./http-CilSfrpq.js";import{_ as Je}from"./_plugin-vue_export-helper-DlAUqK2U.js";const We=Ve("news",()=>{const h=m([]),n=m({}),v=m(null),w=500,B=m(!1),A=m(null),V=m(!0),ne=m(10);let Q=null;const ce=m([]),T=m({}),de=m(null),H=m(!1),ae=m([]),U=m(!1),X=m(null),le=m(""),O=m([]),x=m(!1),E=m(null),fe=m(null),q=new Set;let Y=null;const L=150;async function ve(){if(!q.size)return;const l=Array.from(q);q.clear();try{try{const r=await M.get(`/api/news/body?ids=${encodeURIComponent(l.join(","))}`);if(r.data&&Array.isArray(r.data.items)){const d={};for(const u of r.data.items)u&&u.id&&(d[String(u.id)]=u.body);for(let u=0;u<h.value.length;u++){const y=h.value[u],R=String(y.id);d[R]&&!y.body&&(h.value[u]={...y,body:d[R]})}return}}catch{}for(const r of l)await Z(r)}catch(r){A.value=r.__friendlyMessage||r.message||"bulk body fetch failed"}}function ge(l){const r=String(l),d=h.value.find(u=>String(u.id)===r);d&&d.body||(q.add(r),Y&&clearTimeout(Y),Y=setTimeout(ve,L))}function xe(l){if(!l.length)return;const r=new Set(h.value.map(u=>String(u.id))),d=[];for(const u of l){if(!u||u.id==null)continue;const y=String(u.id);r.has(y)||d.push(u)}d.length&&(d.sort((u,y)=>(y.published_ts||0)-(u.published_ts||0)),h.value=[...d,...h.value],h.value.length>w&&(h.value=h.value.slice(0,w)))}async function z(){try{const l=["limit=100","summary_only=1"];v.value&&l.push(`since_ts=${v.value}`);const d=(await M.get(`/api/news/recent?${l.join("&")}`)).data||{},u=Array.isArray(d.items)?d.items:[],y=!!d.delta;!v.value||!y?h.value=u.sort((R,oe)=>(oe.published_ts||0)-(R.published_ts||0)):xe(u),typeof d.latest_ts=="number"?(!v.value||d.latest_ts>v.value)&&(v.value=d.latest_ts):h.value.length&&(v.value=Math.max(...h.value.map(R=>R.published_ts||0)))}catch(l){A.value=l.__friendlyMessage||l.message||"fetch recent failed"}}async function Z(l){var r;try{const u=(r=(await M.get(`/api/news/article/${l}`)).data)==null?void 0:r.article;if(u&&u.id){const y=h.value.findIndex(R=>String(R.id)===String(l));y>=0?h.value[y]={...h.value[y],body:u.body}:h.value.unshift(u)}}catch(d){A.value=d.__friendlyMessage||d.message||"fetch article failed"}}async function ee(){try{const r=(await M.get("/api/news/status")).data||{},d={running:r.running,fetch_runs:r.fetch_runs,fetch_errors:r.fetch_errors,articles_ingested:r.articles_ingested,lag_seconds:r.lag_seconds,last_run_ts:r.last_run_ts,last_ingested_ts:r.last_ingested_ts,fast_startup_skipped:r.fast_startup_skipped,poll_interval:r.poll_interval,active_sources:Array.isArray(r.active_sources)?r.active_sources:void 0};n.value=d}catch(l){A.value=l.__friendlyMessage||l.message||"fetch status failed"}}async function te(){var l;try{const d=(l=(await M.get("/api/news/feeds/health")).data)==null?void 0:l.feeds;Array.isArray(d)&&(ce.value=d)}catch{}}async function pe(){var l;try{const d=(l=(await M.get("/api/news/feeds/dedup_history")).data)==null?void 0:l.history;d&&typeof d=="object"&&(T.value=d)}catch{}}async function re(){B.value=!0,A.value=null;try{await M.post("/api/news/refresh"),await Promise.all([ee(),z()])}catch(l){A.value=l.__friendlyMessage||l.message||"refresh failed"}finally{B.value=!1}}async function J(){try{await M.post("/api/news/fetch/manual"),await z()}catch(l){A.value=l.__friendlyMessage||l.message||"manual fetch failed"}}async function _e(l){if(!(l<=0))try{await M.post(`/api/news/backfill?days=${l}`)}catch(r){A.value=r.__friendlyMessage||r.message||"backfill failed"}}async function be(l=1440){H.value=!0,A.value=null;try{const r=await M.get(`/api/news/summary?window_minutes=${l}`);de.value=r.data||null}catch(r){A.value=r.__friendlyMessage||r.message||"fetch summary failed"}finally{H.value=!1}}async function me(l=!0,r=!1){if(U.value)return;const d=Date.now();if(!(!r&&X.value&&d-X.value<6e4)){U.value=!0;try{const u=await M.get(`/api/news/sources?include_history=${l?"1":"0"}`);u.data&&(ae.value=u.data.sources||[],T.value=u.data.dedup_history||T.value,X.value=d)}catch(u){A.value=u.__friendlyMessage||u.message||"fetch sources failed"}finally{U.value=!1}}}async function se(l,r=7){var d;if(le.value=l,!l||l.trim().length<2){O.value=[];return}x.value=!0,E.value=null;try{const y=(d=(await M.get(`/api/news/search?q=${encodeURIComponent(l)}&days=${r}&limit=200`)).data)==null?void 0:d.articles;Array.isArray(y)?(O.value=y,fe.value=Date.now()):O.value=[]}catch(u){E.value=u.__friendlyMessage||u.message||"search failed"}finally{x.value=!1}}function W(){he(),V.value&&(Q=setInterval(async()=>{await ee(),le.value.trim().length>=2&&O.value.length>0||await z(),te(),pe()},Math.max(5,ne.value)*1e3))}function he(){Q&&clearInterval(Q),Q=null}function b(l){V.value=typeof l=="boolean"?l:!V.value,W()}function ye(l){ne.value=l,W()}function we(){h.value=[],v.value=null}return{articles:h,status:n,loading:B,error:A,auto:V,intervalSec:ne,lastLatestTs:v,health:ce,dedupHistory:T,summary:de,summaryLoading:H,sources:ae,sourcesLoading:U,sourcesLoadedAt:X,searchQuery:le,searchResults:O,searchLoading:x,searchError:E,searchLastExecuted:fe,fetchRecent:z,fetchStatus:ee,fetchHealth:te,fetchDedupHistory:pe,manualRefresh:re,manualFetchImmediate:J,backfill:_e,fetchSummary:be,fetchSources:me,searchArticles:se,startPolling:W,stopPolling:he,toggleAuto:b,setIntervalSec:ye,clearArticles:we,fetchArticle:Z,queueBodyFetch:ge}});class Ie{constructor(n=100){Me(this,"store",new Map);this.max=n}get(n,v){const w=this.store.get(n);if(w&&w.sig===v)return w.ts=Date.now(),w.value}set(n,v,w){this.store.set(n,{value:w,sig:v,ts:Date.now()}),this.store.size>this.max&&this.evict()}evict(){const n=Array.from(this.store.entries());n.sort((w,B)=>w[1].ts-B[1].ts);const v=Math.ceil(n.length*.1);for(let w=0;w<v;w++)this.store.delete(n[w][0])}clear(){this.store.clear()}}function Ge(h){return h.map(n=>typeof n=="object"?JSON.stringify(n):String(n)).join("|")}const Ke={class:"space-y-4"},Qe={class:"flex flex-wrap gap-4 items-center"},Xe={class:"flex items-center gap-2 text-xs text-neutral-400"},Ye={key:0,class:"text-[10px] text-neutral-500"},Ze={key:0,class:"flex items-center gap-2 text-xs"},et=["disabled"],tt={key:0,class:"animate-pulse"},st={key:1},nt={class:"flex items-center gap-2 text-xs"},at=["disabled"],lt={class:"flex items-center gap-3 text-xs"},rt={class:"flex items-center gap-1"},ot={class:"flex items-center gap-1 cursor-pointer"},it={class:"flex items-center gap-1 cursor-pointer"},ut={class:"flex items-center gap-1 cursor-pointer"},ct=["disabled"],dt={key:0,class:"text-[10px] text-neutral-500"},ft={class:"text-neutral-300"},pt={class:"flex items-center gap-1 text-xs"},mt={key:1,class:"text-[10px] text-neutral-500"},ht={key:2,class:"text-[10px] text-neutral-400 animate-pulse"},vt={class:"flex flex-wrap gap-1 text-[10px]","aria-label":"coin keywords"},gt=["onClick","title"],xt={key:1,class:"flex flex-wrap gap-1 text-[10px]"},_t=["onClick","title"],bt={class:"ml-auto flex items-center gap-2 text-[10px] text-neutral-500"},yt={class:"text-neutral-300"},wt={key:0},kt={key:1},St={class:"flex items-center gap-1"},Ct={class:"text-neutral-300 w-8 text-right"},At={class:"grid md:grid-cols-3 gap-4"},Mt={class:"md:col-span-2 space-y-3"},Ft={key:0,class:"text-xs text-neutral-500"},It={key:1,class:"text-xs text-brand-danger"},Lt={key:2,class:"text-xs text-neutral-500"},Rt={class:"space-y-2"},Tt=["onClick","title"],$t={class:"text-xs text-neutral-500 flex justify-between items-center mb-1"},Nt={class:"flex items-center gap-2"},jt=["title"],Dt={class:"font-mono text-[10px] text-neutral-600"},Bt={class:"text-sm font-medium text-neutral-200 leading-snug"},Et={key:0,class:"text-xs text-neutral-400 mt-1 line-clamp-2"},Pt={key:1,class:"mt-2 text-[11px] text-neutral-300 whitespace-pre-wrap"},Vt={key:0},Ht={key:1,class:"italic text-neutral-500 flex flex-col gap-1"},Ut=["href"],Ot={class:"space-y-3"},qt={class:"p-3 rounded border border-neutral-800 bg-neutral-900/60"},zt={class:"text-[11px] space-y-1"},Jt={class:"flex justify-between"},Wt={class:"flex justify-between"},Gt={class:"flex justify-between"},Kt={class:"flex justify-between"},Qt={class:"flex justify-between"},Xt={key:0,class:"p-3 rounded border border-neutral-800 bg-neutral-900/60"},Yt={class:"flex justify-between items-center mb-2"},Zt=["disabled"],es={class:"space-y-1 max-h-64 overflow-auto pr-1"},ts=["title"],ss={class:"flex justify-between items-center"},ns={class:"font-mono text-neutral-400 flex items-center gap-1"},as={key:0,class:"px-1 py-0.5 rounded bg-rose-600/20 text-rose-300 border border-rose-600/30 text-[9px] tracking-wide"},ls={key:1,class:"px-1 py-0.5 rounded bg-amber-600/20 text-amber-300 border border-amber-600/30 text-[9px] tracking-wide"},rs={class:"flex items-center gap-2"},os={key:0,width:60,height:14,viewBox:"0 0 60 14"},is=["points"],us={class:"w-full h-1.5 bg-neutral-800 rounded overflow-hidden"},cs={class:"flex justify-between text-[10px] text-neutral-500"},ds={key:0,class:"text-amber-400"},fs={key:1,class:"text-neutral-600"},ps={key:2,class:"text-neutral-600"},ms={key:1,class:"p-3 rounded border border-neutral-800 bg-neutral-900/60"},hs={class:"flex justify-between items-center mb-2"},vs={class:"text-xs font-semibold text-neutral-300"},gs=["disabled"],xs={class:"text-[11px] space-y-2"},_s={key:0,class:"flex flex-wrap gap-2"},bs={class:"text-neutral-500"},ys={key:0,class:"text-neutral-300"},ws={key:1},ks={class:"text-neutral-500"},Ss={key:0,class:"text-neutral-300"},Cs={key:1},As={class:"text-emerald-400"},Ms={class:"text-rose-400"},Fs={class:"text-amber-400"},Is={key:1,class:"space-y-1"},Ls={class:"font-mono text-[10px] text-neutral-500 w-20 truncate"},Rs={class:"h-2 bg-neutral-800 rounded w-full relative overflow-hidden"},Ts={class:"text-[10px] text-neutral-400 w-8 text-right"},$s={class:"p-3 rounded border border-neutral-800 bg-neutral-900/60"},Ns=["disabled"],js=["disabled"],Ds={class:"flex items-center gap-2 mb-2 text-[10px]"},Bs=["disabled"],Es={key:0,class:"text-neutral-500 animate-pulse"},Ps={class:"flex items-center gap-2 text-[10px]"},Vs=["disabled"],Hs=["disabled"],Us=["disabled"],Os=["disabled"],qs=He({__name:"NewsView",setup(h){const n=We(),v=F(()=>n.loading),w=F(()=>n.error);function B(){n.manualRefresh()}function A(s){return s?new Date(s*1e3).toLocaleString():"-"}const V=F(()=>{const s=n.status.running,e=n.status.last_run_ts,f=n.status.poll_interval||90,_=e?Date.now()/1e3-e<f*2.2:!1;return s||_?"running":"stopped"}),ne=F(()=>V.value==="running"?"text-brand-accent":"text-neutral-500"),Q=F(()=>{const s=n.status.last_run_ts;if(!s)return"n/a";const e=Date.now()/1e3-s;return e<60?e.toFixed(0)+"s ago":e<3600?Math.floor(e/60)+"m ago":Math.floor(e/3600)+"h ago"}),ce=F(()=>{const s=n.status.lag_seconds;return s==null?"text-neutral-400":s>300?"text-brand-danger":s>120?"text-amber-400":"text-brand-accent"}),T=m(!1);async function de(){if(!T.value){T.value=!0;try{await M.post("/admin/fast_startup/start_component?component=news_ingestion"),await n.fetchStatus()}catch{}finally{T.value=!1}}}Ue(()=>{n.fetchStatus(),n.fetchRecent(),n.fetchHealth(),n.fetchSources(),n.fetchSummary(),n.startPolling(),U(),setInterval(U,6e4)});const H=F(()=>ae.value),ae=m({avg:null,count:0,window_minutes:60,pos:0,neg:0,neutral:0});async function U(){try{const e=(await M.get("/api/news/sentiment?window=60")).data||{};ae.value={avg:typeof e.avg=="number"?e.avg:null,count:e.count||0,window_minutes:e.window_minutes||60,pos:e.pos||0,neg:e.neg||0,neutral:e.neutral||0}}catch{}}const X=F(()=>{const s=H.value.avg;return s===null?"text-neutral-400":s>.4?"text-brand-accent":s>.15?"text-amber-400":s<-.4?"text-brand-danger":s<-.15?"text-amber-400":"text-neutral-300"});function le(s){return s>.4?"bg-emerald-600/20 text-emerald-300 border border-emerald-600/30":s>.15?"bg-amber-500/20 text-amber-300 border border-amber-500/30":s<-.4?"bg-rose-600/20 text-rose-300 border border-rose-600/30":s<-.15?"bg-amber-600/20 text-amber-300 border border-amber-600/30":"bg-neutral-700/40 text-neutral-300 border border-neutral-600/40"}function O(s){return s>.4?"POS":s>.15?"pos":s<-.4?"NEG":s<-.15?"neg":"NEU"}const x=m(["pos","neg","neu"]);function E(){try{localStorage.setItem("news_sentiment_multi",JSON.stringify(x.value))}catch{}}function fe(){x.value=["pos","neg","neu"],E()}try{const s=localStorage.getItem("news_sentiment_multi");if(s){const e=JSON.parse(s);if(Array.isArray(e)&&e.every(f=>["pos","neg","neu"].includes(f))){const f=Array.from(new Set(e.filter(_=>["pos","neg","neu"].includes(_))));f.length&&(x.value=f)}}else{const e=localStorage.getItem("news_sentiment_filter");e==="pos"?x.value=["pos"]:e==="neg"?x.value=["neg"]:e==="neu"?x.value=["neu"]:x.value=["pos","neg","neu"]}}catch{}const q=new Ie(200),Y=F(()=>{const s=x.value.length?x.value:["pos","neg","neu"],e=b.value.trim(),f=Array.from($.value).sort(),_=n.articles.length?n.articles[0].id+":"+n.articles.length+":"+(n.articles[0].published_ts||""):"empty",a=Ge([_,s,e,f]),I=q.get("filtered",a);if(I)return I;let C=n.articles.filter(N=>{if(N.sentiment==null)return s.length===3;const k=N.sentiment,S=k>.15,j=k<-.15,G=!S&&!j;return S&&s.includes("pos")||j&&s.includes("neg")||G&&s.includes("neu")});if(e){const N=e.split(/\s+/).filter(k=>k.length>1).map(k=>k.toLowerCase());N.length&&(C=C.filter(k=>{const S=((k.title||"")+" "+(k.summary||"")+" "+(k.body||"")).toLowerCase();return N.every(j=>$.value.has(j)||S.includes(j))}))}return q.set("filtered",a,C),C}),L=m(60);function ve(){try{localStorage.setItem("news_window_minutes",String(L.value))}catch{}}try{const s=localStorage.getItem("news_window_minutes");if(s){const e=parseInt(s,10);!isNaN(e)&&e>=5&&e<=240&&(L.value=e)}}catch{}const ge=Y,xe=F(()=>{const e=Date.now()/1e3-L.value*60;return ge.value.filter(f=>f.published_ts?f.published_ts>=e:!1)}),z=F(()=>b.value.trim().length>=2&&n.searchResults.length&&!n.searchLoading),Z=F(()=>z.value?n.searchResults:xe.value),ee=()=>{n.fetchSources(!0,!0)},te=()=>{n.fetchSummary(L.value)},pe=()=>{n.manualFetchImmediate()},re=m(3),J=m(!1);async function _e(){if(!J.value){J.value=!0;try{await n.backfill(re.value),await n.fetchRecent(),await n.fetchSummary(L.value)}finally{J.value=!1}}}function be(s){const e=[];return s.stalled&&e.push("stalled"),s.dedup_anomaly&&e.push("dedup anomaly"),s.backoff_remaining>0&&e.push(`backoff ${s.backoff_remaining.toFixed(0)}s`),s.dedup_last_ratio!=null&&e.push(`last ratio ${(s.dedup_last_ratio*100).toFixed(1)}%`),s.score!=null&&e.push(`score ${s.score.toFixed(2)}`),e.join(" | ")}function me(s){const e=n.sources.find(G=>G.source===s),f=(e==null?void 0:e.dedup_history)||(e==null?void 0:e.history)||[];if(!f.length)return"";const _=f.slice(-20),a=Math.max(..._,1),I=Math.min(..._,0),C=14,N=60,k=_.length;if(k===1)return`0,${(C/2).toFixed(1)}`;const S=N/(k-1);return _.map((G,je)=>{const De=(G-I)/(a-I||1),Be=C-De*C;return`${(je*S).toFixed(1)},${Be.toFixed(1)}`}).join(" ")}Oe(()=>L.value,s=>{setTimeout(()=>te(),50)});const se=m(new Set);function W(s){return se.value.has(String(s.id))}function he(s){const e=String(s.id);se.value.has(e)?se.value.delete(e):(se.value.add(e),s.body||n.queueBodyFetch(s.id))}const b=m(""),ye=["BTC","ETH","XRP","SOL","DOGE","BNB","비트코인","이더리움"];function we(s){b.value.includes(s)||(b.value&&!b.value.endsWith(" ")&&(b.value+=" "),b.value+=s+" ",r())}let l=null;function r(){d(),l&&clearTimeout(l);const s=b.value.trim();if(s.length<2){n.searchResults=[];return}l=setTimeout(()=>{n.searchArticles(s)},300)}function d(){try{localStorage.setItem("news_search_term",b.value)}catch{}}function u(){b.value="",d()}try{const s=localStorage.getItem("news_search_term");s&&s.trim()?b.value=s:(b.value="coin ",d()),r()}catch{}function y(s){return s.replace(/[&<>"]|'/g,e=>{switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return e}})}const R=new Ie(500);function oe(s){if(!s)return"";const e=b.value.trim();if(!e)return y(s);const f=e.split(/\s+/).filter(S=>S.length>1).map(S=>S.toLowerCase()).filter(S=>!$.value.has(S));if(!f.length)return y(s);const _=Array.from(new Set(f)).sort((S,j)=>j.length-S.length),a=_.join(",")+"|"+$.value.size,C=s.slice(0,64)+"|"+a,N=R.get(C,C);if(N)return N;let k=y(s);try{const S=_.map(G=>G.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|"),j=new RegExp("("+S+")","gi");k=k.replace(j,'<span class="highlight">$1</span>')}catch{}return R.set(C,C,k),k}const $=m(new Set),Ae=F(()=>{const s=b.value.trim();return s?Array.from(new Set(s.split(/\s+/).filter(f=>f.length>1).map(f=>f.toLowerCase()))).map(f=>({text:f,disabled:$.value.has(f),key:f})):[]});function Le(s){const e=s.toLowerCase();$.value.has(e)?$.value.delete(e):$.value.add(e),$.value=new Set($.value)}function Re(s){return s==null?"text-neutral-500":s>=.8?"text-emerald-400":s>=.6?"text-emerald-300":s>=.4?"text-amber-400":s>=.2?"text-rose-400":"text-rose-500"}function Te(s){if(s==null)return{width:"0%",backgroundColor:"#444"};const e=Math.max(0,Math.min(1,s))*100;let f="#22c55e";return s<.2?f="#dc2626":s<.4?f="#f87171":s<.6?f="#f59e0b":s<.8&&(f="#4ade80"),{width:e+"%",backgroundColor:f,transition:"width 0.4s ease"}}const ke=m({}),$e=m({});function Ne(){const s=Date.now()/1e3;for(const e of n.health){const f=ke.value[e.source],_=e.score;if(_==null)continue;const a=.3,I=f!=null?f>=a:void 0,C=_>=a;if(I===void 0){ke.value[e.source]=_;continue}I!==C&&($e.value[e.source]=s),ke.value[e.source]=_}}return setInterval(()=>{Ne()},5e3),(s,e)=>{var _;const f=qe("safe-html");return i(),o("div",Ke,[t("div",Qe,[t("div",Xe,[e[10]||(e[10]=t("span",{class:"font-semibold text-neutral-200"},"Status:",-1)),t("span",{class:P(ne.value)},p(V.value),3),c(n).status.last_run_ts?(i(),o("span",Ye,"(last "+p(Q.value)+", interval "+p(c(n).status.poll_interval||"n/a")+"s)",1)):g("",!0)]),c(n).status.fast_startup_skipped?(i(),o("div",Ze,[e[11]||(e[11]=t("span",{class:"px-2 py-0.5 rounded bg-neutral-700/60 border border-neutral-600 text-neutral-300"},"FAST_STARTUP Skipped",-1)),t("button",{class:"btn-xs",disabled:T.value,onClick:de},[T.value?(i(),o("span",tt,"Starting...")):(i(),o("span",st,"Start News Only"))],8,et)])):g("",!0),t("div",nt,[t("button",{class:"btn-xs",onClick:B,disabled:v.value},"Manual Refresh",8,at),t("button",{class:P(["btn-xs",c(n).auto?"bg-neutral-700":"bg-neutral-800"]),onClick:e[0]||(e[0]=a=>c(n).toggleAuto())},p(c(n).auto?"Auto: On":"Auto: Off"),3),D(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>c(n).intervalSec=a),onChange:e[2]||(e[2]=a=>c(n).startPolling()),class:"bg-neutral-900 text-xs px-2 py-1 rounded border border-neutral-700"},[...e[12]||(e[12]=[t("option",{value:5},"5s",-1),t("option",{value:10},"10s",-1),t("option",{value:30},"30s",-1),t("option",{value:60},"60s",-1)])],544),[[ze,c(n).intervalSec,void 0,{number:!0}]])]),t("div",lt,[t("div",rt,[e[16]||(e[16]=t("span",{class:"text-neutral-400"},"Sentiment",-1)),t("label",ot,[D(t("input",{type:"checkbox",value:"pos","onUpdate:modelValue":e[3]||(e[3]=a=>x.value=a),onChange:E,class:"accent-emerald-500 w-3 h-3"},null,544),[[Se,x.value]]),e[13]||(e[13]=t("span",{class:"text-[10px] text-emerald-300"},"Pos",-1))]),t("label",it,[D(t("input",{type:"checkbox",value:"neg","onUpdate:modelValue":e[4]||(e[4]=a=>x.value=a),onChange:E,class:"accent-rose-500 w-3 h-3"},null,544),[[Se,x.value]]),e[14]||(e[14]=t("span",{class:"text-[10px] text-rose-300"},"Neg",-1))]),t("label",ut,[D(t("input",{type:"checkbox",value:"neu","onUpdate:modelValue":e[5]||(e[5]=a=>x.value=a),onChange:E,class:"accent-amber-500 w-3 h-3"},null,544),[[Se,x.value]]),e[15]||(e[15]=t("span",{class:"text-[10px] text-amber-300"},"Neu",-1))]),t("button",{class:"btn-xs !px-1.5 !text-[10px]",onClick:fe,disabled:x.value.length===3,title:"Reset to All"},"All",8,ct)]),x.value.length!==3?(i(),o("span",dt,[e[17]||(e[17]=K("Filtered: ",-1)),t("span",ft,p(Y.value.length),1),e[18]||(e[18]=K("/",-1)),t("span",null,p(c(n).articles.length),1)])):g("",!0)]),t("div",pt,[D(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>b.value=a),onInput:r,type:"text",placeholder:"coin, BTC, ETH, XRP, 비트코인 (2+ chars)",class:"bg-neutral-900 text-[10px] px-2 py-1 rounded border border-neutral-700 focus:outline-none focus:border-brand-accent w-56"},null,544),[[Ce,b.value]]),b.value?(i(),o("button",{key:0,class:"btn-xs !px-1.5 !text-[10px]",onClick:u,title:"검색어 지우기"},"✕")):g("",!0),z.value?(i(),o("span",mt,p(c(n).searchResults.length)+" hits",1)):g("",!0),c(n).searchLoading?(i(),o("span",ht,"검색중...")):g("",!0)]),t("div",vt,[(i(),o(ie,null,ue(ye,a=>t("button",{key:a,class:"px-1.5 py-0.5 rounded border border-neutral-700 bg-neutral-800 hover:border-brand-accent transition",onClick:I=>we(a),title:a+" 추가"},p(a),9,gt)),64))]),Ae.value.length?(i(),o("div",xt,[(i(!0),o(ie,null,ue(Ae.value,a=>(i(),o("button",{key:a.key,onClick:I=>Le(a.text),class:P(["px-1.5 py-0.5 rounded border transition",a.disabled?"bg-neutral-800 border-neutral-700 text-neutral-500 line-through":"bg-neutral-700/60 border-neutral-600 text-neutral-200 hover:border-brand-accent"]),title:a.disabled?"클릭하여 다시 활성화":"클릭하여 비활성화"},p(a.text),11,_t))),128))])):g("",!0),t("div",bt,[t("span",null,[e[19]||(e[19]=K("Articles: ",-1)),t("span",yt,p(Z.value.length),1)]),c(n).status.lag_seconds!=null?(i(),o("span",wt,[e[20]||(e[20]=K("Lag: ",-1)),t("span",{class:P(ce.value)},p(c(n).status.lag_seconds.toFixed(1))+"s",3)])):g("",!0),H.value.avg!==null?(i(),o("span",kt,[e[21]||(e[21]=K("Sentiment: ",-1)),t("span",{class:P(X.value)},p(H.value.avg.toFixed(2)),3)])):g("",!0),t("div",St,[e[22]||(e[22]=t("span",{class:"text-neutral-400"},"Win",-1)),D(t("input",{type:"range",min:"5",max:"240",step:"5","onUpdate:modelValue":e[7]||(e[7]=a=>L.value=a),onInput:ve,class:"w-24"},null,544),[[Ce,L.value,void 0,{number:!0}]]),t("span",Ct,p(L.value)+"m",1)])])]),t("div",At,[t("div",Mt,[v.value?(i(),o("div",Ft,"Loading...")):g("",!0),w.value?(i(),o("div",It,"Error: "+p(w.value),1)):g("",!0),!v.value&&Z.value.length===0?(i(),o("div",Lt,"No articles yet.")):g("",!0),t("ul",Rt,[(i(!0),o(ie,null,ue(Z.value,a=>(i(),o("li",{key:a.id,class:"p-3 rounded border border-neutral-800 bg-neutral-900/60 hover:border-neutral-700 transition cursor-pointer",onClick:I=>he(a),title:W(a)?"클릭하여 접기":"클릭하여 전체 보기"},[t("div",$t,[t("span",Nt,[t("span",null,p(A(a.published_ts)),1),a.sentiment!=null?(i(),o("span",{key:0,class:P(["px-1.5 py-0.5 rounded text-[10px] font-mono",le(a.sentiment)]),title:"sentiment: "+a.sentiment.toFixed(2)},p(O(a.sentiment)),11,jt)):g("",!0)]),t("span",Dt,p(a.source),1)]),D(t("div",Bt,null,512),[[f,oe(a.title)]]),!W(a)&&a.summary?D((i(),o("div",Et,null,512)),[[f,oe(a.summary)]]):g("",!0),W(a)?(i(),o("div",Pt,[a.body?D((i(),o("div",Vt,null,512)),[[f,oe(a.body)]]):(i(),o("div",Ht,[e[23]||(e[23]=t("span",null,"본문 없음",-1)),a.url?(i(),o("a",{key:0,href:a.url,target:"_blank",rel:"noopener",class:"text-brand-accent underline"},"원문 열기 ↗",8,Ut)):g("",!0)]))])):g("",!0)],8,Tt))),128))])]),t("div",Ot,[t("div",qt,[e[29]||(e[29]=t("div",{class:"text-xs font-semibold text-neutral-300 mb-2"},"Ingestion Stats",-1)),t("dl",zt,[t("div",Jt,[e[24]||(e[24]=t("dt",{class:"text-neutral-500"},"Fetch Runs",-1)),t("dd",null,p(c(n).status.fetch_runs??"-"),1)]),t("div",Wt,[e[25]||(e[25]=t("dt",{class:"text-neutral-500"},"Errors",-1)),t("dd",{class:P({"text-brand-danger":(c(n).status.fetch_errors||0)>0})},p(c(n).status.fetch_errors??"-"),3)]),t("div",Gt,[e[26]||(e[26]=t("dt",{class:"text-neutral-500"},"Articles Ingested",-1)),t("dd",null,p(c(n).status.articles_ingested??"-"),1)]),t("div",Kt,[e[27]||(e[27]=t("dt",{class:"text-neutral-500"},"Lag (s)",-1)),t("dd",null,p(((_=c(n).status.lag_seconds)==null?void 0:_.toFixed(1))??"-"),1)]),t("div",Qt,[e[28]||(e[28]=t("dt",{class:"text-neutral-500"},"Running",-1)),t("dd",null,p(c(n).status.running?"yes":"no"),1)])])]),c(n).sources.length?(i(),o("div",Xt,[t("div",Yt,[e[30]||(e[30]=t("div",{class:"text-xs font-semibold text-neutral-300"},"Source Health",-1)),t("button",{class:"btn-xs !text-[10px]",onClick:ee,disabled:c(n).sourcesLoading},"↻",8,Zt)]),t("ul",es,[(i(!0),o(ie,null,ue(c(n).sources,a=>(i(),o("li",{key:a.source,class:"text-[11px] flex flex-col gap-0.5",title:be(a)},[t("div",ss,[t("span",ns,[t("span",null,p(a.source),1),a.stalled?(i(),o("span",as,"STALL")):a.dedup_anomaly?(i(),o("span",ls,"ANOM")):g("",!0)]),t("div",rs,[me(a.source).length?(i(),o("svg",os,[t("polyline",{points:me(a.source),fill:"none",stroke:"#22c55e","stroke-width":"1.1","stroke-linejoin":"round","stroke-linecap":"round"},null,8,is)])):g("",!0),t("span",{class:P(Re(a.score))},p(a.score!=null?a.score.toFixed(2):"--"),3)])]),t("div",us,[t("div",{class:"h-full",style:Fe(Te(a.score))},null,4)]),t("div",cs,[a.backoff_remaining>0?(i(),o("span",ds,"backoff "+p(a.backoff_remaining.toFixed(0))+"s",1)):(i(),o("span",fs,"ok")),a.dedup_last_ratio!=null?(i(),o("span",ps,"ratio "+p((a.dedup_last_ratio*100).toFixed(0))+"%",1)):g("",!0)])],8,ts))),128))])])):g("",!0),c(n).summary?(i(),o("div",ms,[t("div",hs,[t("div",vs,"Summary ("+p(c(n).summary.total)+" / "+p(c(n).summary.window_minutes)+"m)",1),t("button",{class:"btn-xs !text-[10px]",onClick:te,disabled:c(n).summaryLoading},"↻",8,gs)]),t("div",xs,[c(n).summary.sentiment?(i(),o("div",_s,[t("span",bs,[e[31]||(e[31]=K("avg: ",-1)),c(n).summary.sentiment.avg!=null?(i(),o("span",ys,p(c(n).summary.sentiment.avg.toFixed(2)),1)):(i(),o("span",ws,"--"))]),t("span",ks,[e[32]||(e[32]=K("std: ",-1)),c(n).summary.sentiment.std!=null?(i(),o("span",Ss,p(c(n).summary.sentiment.std.toFixed(2)),1)):(i(),o("span",Cs,"--"))]),t("span",As,"pos "+p(c(n).summary.sentiment.pos),1),t("span",Ms,"neg "+p(c(n).summary.sentiment.neg),1),t("span",Fs,"neu "+p(c(n).summary.sentiment.neutral),1)])):g("",!0),c(n).summary.sources&&c(n).summary.sources.length?(i(),o("div",Is,[(i(!0),o(ie,null,ue(c(n).summary.sources.slice(0,6),a=>(i(),o("div",{key:a.source,class:"flex items-center gap-2"},[t("span",Ls,p(a.source),1),t("div",Rs,[t("div",{class:"h-full bg-brand-accent/60",style:Fe({width:(a.ratio*100).toFixed(1)+"%"})},null,4)]),t("span",Ts,p(a.count),1)]))),128))])):g("",!0)])])):g("",!0),t("div",$s,[e[33]||(e[33]=t("div",{class:"text-xs font-semibold text-neutral-300 mb-2"},"Manual Controls",-1)),t("button",{class:"btn-xs w-full mb-2",onClick:B,disabled:v.value},"Legacy Refresh",8,Ns),t("button",{class:"btn-xs w-full mb-2",onClick:pe,disabled:v.value},"Manual Fetch (Immediate)",8,js),t("div",Ds,[D(t("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>re.value=a),type:"number",min:"1",max:"30",class:"w-14 px-1 py-0.5 bg-neutral-900 border border-neutral-700 rounded"},null,512),[[Ce,re.value,void 0,{number:!0}]]),t("button",{class:"btn-xs",onClick:_e,disabled:J.value},"Backfill",8,Bs),J.value?(i(),o("span",Es,"...")):g("",!0)]),t("div",Ps,[t("button",{class:"btn-xs",onClick:ee,disabled:c(n).sourcesLoading},"Sources",8,Vs),t("button",{class:"btn-xs",onClick:te,disabled:c(n).summaryLoading},"Summary",8,Hs),t("button",{class:"btn-xs",onClick:u,disabled:!b.value},"Clear Search",8,Us)]),t("button",{class:"btn-xs w-full",onClick:e[9]||(e[9]=(...a)=>c(n).clearArticles&&c(n).clearArticles(...a)),disabled:v.value},"Clear Articles",8,Os)])])])])}}}),Qs=Je(qs,[["__scopeId","data-v-9592b1e2"]]);export{Qs as default};
