import{d as rt,c as a,k as C,m as N,H as ot,l as nt,a as y,b as s,f as S,i as l,p as b,E as U,q,t as n,A as i,v as O,z as g,F as lt,r as at,n as it,I as ut,e as m}from"./index-BtrOmqR2.js";import{u as dt}from"./trainingJobs-Csi7WAeR.js";import{_ as pt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./http-CilSfrpq.js";const vt={class:"space-y-6"},ct={class:"card"},yt={class:"flex items-center justify-between mb-4"},gt={class:"flex items-center gap-3 text-xs"},mt={class:"flex items-center gap-2 pr-3 mr-3 border-r border-neutral-700/60"},bt={class:"flex items-center gap-1 cursor-pointer select-none"},ft={class:"flex items-center gap-1 cursor-pointer select-none"},xt={class:"flex items-center gap-1 cursor-pointer select-none"},kt=["disabled"],Dt={key:0},Ct={key:1},_t={key:0,class:"px-2 py-0.5 rounded bg-neutral-800 text-neutral-200 border border-neutral-700"},Kt=["disabled"],St={class:"flex items-center gap-2"},wt={class:"flex items-center gap-1 text-neutral-300"},$t={class:"flex items-center gap-1 text-neutral-300"},Ft={class:"flex items-center gap-2 text-xs"},Tt={class:"px-2 py-0.5 rounded bg-neutral-800 border border-neutral-700 text-neutral-300"},Mt={class:"px-2 py-0.5 rounded bg-emerald-900/30 border border-emerald-700 text-emerald-300"},Vt={class:"px-2 py-0.5 rounded bg-rose-900/30 border border-rose-700 text-rose-300"},It={class:"flex items-center gap-1 cursor-pointer select-none"},Ut={class:"flex items-center gap-1"},qt={class:"flex items-center gap-1"},At={key:0,class:"px-2 py-0.5 rounded bg-brand-danger/20 text-brand-danger"},Et={class:"overflow-x-auto"},Jt={class:"min-w-full text-sm select-none"},Lt={class:"text-left text-neutral-400 border-b border-neutral-700/60"},ht={class:"py-1 pr-4 font-mono"},zt={class:"py-1 pr-4"},Bt={class:"py-1 pr-4"},Ht=["title"],Nt={class:"py-1 pr-4"},Ot={key:0,class:"ml-1 text-[10px] text-neutral-500",title:"메트릭 없음 (레거시/실패)"},Pt={class:"py-1 pr-4"},Rt={class:"py-1 pr-4"},Yt={class:"py-1 pr-4"},Xt={class:"py-1 pr-4"},Gt={class:"py-1 pr-4"},Qt=["title"],Wt=["title"],Zt=["title"],jt=["title"],te=["title"],ee={key:0},se=rt({__name:"TrainingJobs",setup(re){const o=dt(),A=ot(),P=ut(),{fetchJobs:_,start:E}=o,J=a(()=>o.loading),L=a(()=>o.error),w=a({get:()=>o.statusFilter,set:r=>o.statusFilter=r}),$=a({get:()=>o.triggerFilter,set:r=>o.triggerFilter=r}),h=a({get:()=>o.auto,set:r=>o.toggleAuto(r)}),x=a({get:()=>o.intervalSec,set:r=>o.setIntervalSec(r)}),z=a(()=>o.filteredSorted),d=a(()=>o.sortKey),p=a(()=>o.sortDir),v=o.setSort,B=o.jobDurationMs,R=r=>o.statusColor(r),F=a({get:()=>o.limit,set:r=>o.setLimit(r)});function Y(){typeof o.setIntervalSec=="function"&&o.setIntervalSec(x.value??x)}const T=C(!0),M=C(!1),V=C("bottom"),k=C(!1),f=C(null);async function X(){if(!k.value){k.value=!0,f.value=null;try{const r=await fetch("/api/training/run",{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":window.API_KEY||"dev-key"},body:JSON.stringify({trigger:"manual_ui",sentiment:T.value,force:M.value,target:V.value})});if(!r.ok)throw new Error(`HTTP ${r.status}`);const t=await r.json();f.value=`시작됨: job ${t.job_id}${t.sentiment_requested?" +sentiment":""}`,await _(),E()}catch(r){f.value=`시작 실패: ${(r==null?void 0:r.message)||String(r)}`}finally{k.value=!1,window.setTimeout(()=>{f.value=null},5e3)}}}function D(r,t){var u;const e=(u=r.metrics)==null?void 0:u[t];return e==null?"—":typeof e=="number"?e.toFixed(3):String(e)}function H(r){try{const t=/^\d+(?:\.\d+)?$/.test(r)?new Date(parseFloat(r)*1e3):new Date(r),e=I=>I<10?"0"+I:""+I,u=t.getFullYear(),K=e(t.getMonth()+1),tt=e(t.getDate()),et=e(t.getHours()),st=e(t.getMinutes());return`${u}-${K}-${tt} ${et}:${st}`}catch{return r}}function G(r){const t=B(r),e=Math.floor(t/1e3);if(e<60)return e+"s";const u=Math.floor(e/60);return u<60?u+"m":Math.floor(u/60)+"h"}function Q(r){return(B(r)/1e3).toFixed(1)+"s"}const c=r=>r.sortKey!==r.k?null:r.sortDir==="asc"?"▲":"▼";N(()=>{_(),E()}),N(()=>{const r=A.query||{},t=String(r.status||"").toLowerCase(),e=String(r.trigger||"").toLowerCase(),u=["all","running","success","error"],K=["all","manual","auto","other"];u.includes(t)&&(o.statusFilter=t),K.includes(e)&&(o.triggerFilter=e)}),nt([w,$],([r,t])=>{const e={...A.query};r&&r!=="all"?e.status=r:delete e.status,t&&t!=="all"?e.trigger=t:delete e.trigger,P.replace({query:e})});const W=a(()=>o.jobs.length),Z=a(()=>o.jobs.filter(r=>r.status==="success").length),j=a(()=>o.jobs.filter(r=>r.status==="error").length);return(r,t)=>(m(),y("div",vt,[s("section",ct,[s("div",yt,[t[31]||(t[31]=s("h1",{class:"text-xl font-semibold"},"Training Jobs",-1)),s("div",gt,[s("div",mt,[s("label",bt,[t[19]||(t[19]=l(" 타겟 ",-1)),b(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>V.value=e),class:"bg-neutral-800 border border-neutral-700 rounded px-1 py-0.5 text-[12px]"},[...t[18]||(t[18]=[s("option",{value:"bottom"},"bottom",-1),s("option",{value:"direction"},"direction",-1)])],512),[[U,V.value]])]),s("label",ft,[b(s("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=e=>T.value=e)},null,512),[[q,T.value]]),t[20]||(t[20]=l(" sentiment 포함 ",-1))]),s("label",xt,[b(s("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>M.value=e)},null,512),[[q,M.value]]),t[21]||(t[21]=l(" 강제(force) ",-1))]),s("button",{class:"btn bg-emerald-700 hover:bg-emerald-600",disabled:k.value,onClick:X},[k.value?(m(),y("span",Dt,"실행중…")):(m(),y("span",Ct,"재학습 실행"))],8,kt),f.value?(m(),y("span",_t,n(f.value),1)):S("",!0)]),s("button",{class:"btn",disabled:J.value,onClick:t[3]||(t[3]=(...e)=>i(_)&&i(_)(...e))},"새로고침",8,Kt),s("div",St,[s("label",wt,[t[23]||(t[23]=l(" 상태 ",-1)),b(s("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>w.value=e),class:"bg-neutral-800 border border-neutral-700 rounded px-1 py-0.5 text-[12px]"},[...t[22]||(t[22]=[s("option",{value:"all"},"전체",-1),s("option",{value:"running"},"running",-1),s("option",{value:"success"},"success",-1),s("option",{value:"error"},"error",-1)])],512),[[U,w.value]])]),s("label",$t,[t[25]||(t[25]=l(" 트리거 ",-1)),b(s("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>$.value=e),class:"bg-neutral-800 border border-neutral-700 rounded px-1 py-0.5 text-[12px]",title:"manual_ui 등은 manual로 분류, drift_auto 등은 auto로 분류"},[...t[24]||(t[24]=[s("option",{value:"all"},"전체",-1),s("option",{value:"manual"},"manual",-1),s("option",{value:"auto"},"auto",-1),s("option",{value:"other"},"other",-1)])],512),[[U,$.value]])])]),s("div",Ft,[s("span",Tt,"전체 "+n(W.value),1),s("span",Mt,"성공 "+n(Z.value),1),s("span",Vt,"실패 "+n(j.value),1)]),s("label",It,[b(s("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=e=>h.value=e)},null,512),[[q,h.value]]),t[26]||(t[26]=l(" 자동 ",-1))]),s("div",Ut,[t[27]||(t[27]=l(" 간격 ",-1)),b(s("input",{type:"range",min:"5",max:"60","onUpdate:modelValue":t[7]||(t[7]=e=>x.value=e),onChange:Y},null,544),[[O,x.value,void 0,{number:!0}]]),t[28]||(t[28]=l()),s("span",null,n(x.value)+"s",1)]),s("div",qt,[t[29]||(t[29]=l(" 표시 ",-1)),b(s("input",{type:"range",min:"20",max:"200",step:"10","onUpdate:modelValue":t[8]||(t[8]=e=>F.value=e)},null,512),[[O,F.value,void 0,{number:!0}]]),t[30]||(t[30]=l()),s("span",null,n(F.value),1)]),L.value?(m(),y("span",At,n(L.value),1)):S("",!0)])]),s("div",Et,[s("table",Jt,[s("thead",Lt,[s("tr",null,[s("th",{class:"py-1 pr-4 cursor-pointer",onClick:t[9]||(t[9]=e=>i(v)("id"))},[t[32]||(t[32]=l("ID ",-1)),g(c,{k:"id",sortKey:d.value,sortDir:p.value},null,8,["sortKey","sortDir"])]),s("th",{class:"py-1 pr-4 cursor-pointer",onClick:t[10]||(t[10]=e=>i(v)("status"))},[t[33]||(t[33]=l("Status ",-1)),g(c,{k:"status",sortKey:d.value,sortDir:p.value},null,8,["sortKey","sortDir"])]),t[41]||(t[41]=s("th",{class:"py-1 pr-4"},"Trigger",-1)),t[42]||(t[42]=s("th",{class:"py-1 pr-4"},"Feature",-1)),s("th",{class:"py-1 pr-4 cursor-pointer",onClick:t[11]||(t[11]=e=>i(v)("version"))},[t[34]||(t[34]=l("Version ",-1)),g(c,{k:"version",sortKey:d.value,sortDir:p.value},null,8,["sortKey","sortDir"])]),s("th",{class:"py-1 pr-4 cursor-pointer",onClick:t[12]||(t[12]=e=>i(v)("auc"))},[t[35]||(t[35]=l("AUC ",-1)),g(c,{k:"auc",sortKey:d.value,sortDir:p.value},null,8,["sortKey","sortDir"])]),s("th",{class:"py-1 pr-4 cursor-pointer",onClick:t[13]||(t[13]=e=>i(v)("accuracy"))},[t[36]||(t[36]=l("ACC ",-1)),g(c,{k:"accuracy",sortKey:d.value,sortDir:p.value},null,8,["sortKey","sortDir"])]),s("th",{class:"py-1 pr-4 cursor-pointer",onClick:t[14]||(t[14]=e=>i(v)("brier"))},[t[37]||(t[37]=l("Brier ",-1)),g(c,{k:"brier",sortKey:d.value,sortDir:p.value},null,8,["sortKey","sortDir"])]),s("th",{class:"py-1 pr-4 cursor-pointer",onClick:t[15]||(t[15]=e=>i(v)("ece"))},[t[38]||(t[38]=l("ECE ",-1)),g(c,{k:"ece",sortKey:d.value,sortDir:p.value},null,8,["sortKey","sortDir"])]),t[43]||(t[43]=s("th",{class:"py-1 pr-4"},"val_samples",-1)),s("th",{class:"py-1 pr-4 cursor-pointer",onClick:t[16]||(t[16]=e=>i(v)("created_at"))},[t[39]||(t[39]=l("Created ",-1)),g(c,{k:"created_at",sortKey:d.value,sortDir:p.value},null,8,["sortKey","sortDir"])]),t[44]||(t[44]=s("th",{class:"py-1 pr-4"},"Finished",-1)),s("th",{class:"py-1 pr-4 cursor-pointer",onClick:t[17]||(t[17]=e=>i(v)("duration"))},[t[40]||(t[40]=l("Duration ",-1)),g(c,{k:"duration",sortKey:d.value,sortDir:p.value},null,8,["sortKey","sortDir"])]),t[45]||(t[45]=s("th",{class:"py-1 pr-4"},"Artifact",-1)),t[46]||(t[46]=s("th",{class:"py-1 pr-4"},"Error",-1))])]),s("tbody",null,[(m(!0),y(lt,null,at(z.value,e=>(m(),y("tr",{key:e.id,class:"border-b border-neutral-800/40 hover:bg-neutral-800/30"},[s("td",ht,n(e.id),1),s("td",zt,[s("span",{class:it(R(e.status))},n(e.status),3)]),s("td",Bt,n(e.trigger),1),s("td",{class:"py-1 pr-4",title:e.drift_z!=null?"z="+e.drift_z:void 0},n(e.drift_feature||"—"),9,Ht),s("td",Nt,[l(n(e.version||"—")+" ",1),e.metrics?S("",!0):(m(),y("span",Ot,"legacy"))]),s("td",Pt,n(D(e,"auc")),1),s("td",Rt,n(D(e,"accuracy")),1),s("td",Yt,n(D(e,"brier")),1),s("td",Xt,n(D(e,"ece")),1),s("td",Gt,n(D(e,"val_samples")),1),s("td",{class:"py-1 pr-4",title:e.created_at},n(H(e.created_at)),9,Qt),s("td",{class:"py-1 pr-4",title:e.finished_at||void 0},n(e.finished_at?H(e.finished_at):"—"),9,Wt),s("td",{class:"py-1 pr-4 font-mono",title:Q(e)},n(G(e)),9,Zt),s("td",{class:"py-1 pr-4 truncate max-w-[160px]",title:e.artifact_path??void 0},n(e.artifact_path?e.artifact_path.split("/").pop():"—"),9,jt),s("td",{class:"py-1 pr-4 text-brand-danger max-w-[160px] truncate",title:e.error??void 0},n(e.error?e.error:"—"),9,te)]))),128)),!J.value&&z.value.length===0?(m(),y("tr",ee,[...t[47]||(t[47]=[s("td",{colspan:"14",class:"py-4 text-center text-neutral-500"}," 기록이 없습니다. 과거 데이터가 DB에 남아있다면 상단 표시 개수를 늘려보세요. ",-1)])])):S("",!0)])])])])]))}}),ie=pt(se,[["__scopeId","data-v-b09203e3"]]);export{ie as default};
