import{o as H,d as W,c as v,a as g,F as K,r as et,b as t,t as p,n as q,e as f,f as L,g as zt,h as xt,w as st,i as M,j as Jt,u as nt,k as I,l as B,m as kt,p as U,v as at,q as Z,s as Ht,x as Kt,y as yt,z as O,A as c,B as Wt,C as vt}from"./index-BtrOmqR2.js";import{u as Gt,c as Qt,a as Xt,h as Yt,_ as ht,M as E}from"./tradingActivity-C9RmvY8q.js";import tt from"./http-CilSfrpq.js";import{_ as Zt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as te}from"./ingestion-LZaYOlHt.js";function ee(){const s=new Map;let o=!1;function u(a){l(a.id),a.immediate&&i(a),a.timer=setInterval(()=>{o||a.enabled&&!a.enabled()||i(a)},a.interval)}function i(a){try{const b=a.run();b&&typeof b.then=="function"&&b.catch(()=>{})}catch{}}function d(a){const b=s.get(a.id),_={...a};s.set(a.id,_),u(_)}function r(a,b){const _=s.get(a);_&&(_.interval=b,u(_))}function l(a){const b=s.get(a);b&&b.timer&&(clearInterval(b.timer),b.timer=null)}function k(a){l(a),s.delete(a)}function $(){for(const a of s.values())l(a.id)}function F(){for(const a of s.values())u(a)}function h(){if(document.hidden)o=!0;else{o=!1;for(const a of s.values())i(a)}}return document.addEventListener("visibilitychange",h),H(()=>{$(),document.removeEventListener("visibilitychange",h)}),{register:d,remove:k,updateInterval:r,stopJob:l,restartAll:F,stopAll:$}}const P={ingestion:"Ingestion",features:"Features",news:"News",drift:"Drift",calibration_monitor:"Calibration",risk:"Risk"};function se(s){var u;const o=[];if(!s||typeof s!="object")return o;if(s.ingestion){const i=s.ingestion,d=i.stale?"bg-amber-400":i.running?"bg-green-400":"bg-neutral-500",r=[];i.running&&r.push({k:"lag",v:`lag ${i.lag_seconds??"-"}s`}),r.push({k:"buf",v:`msgs ${i.total_messages??"-"} / rec ${i.reconnect_attempts??"-"}`}),o.push({key:"ingestion",label:P.ingestion,indicatorClass:d,lines:r})}if(s.features){const i=s.features,d=i.health,r=d==="ok"?"bg-green-400":d==="degraded"?"bg-amber-400":d==="stopped"?"bg-red-500":"bg-neutral-500",l=[];i.last_success_ts&&l.push({k:"lag",v:`lag ${i.lag_sec??"-"}s`}),l.push({k:"run",v:i.running?"running":"idle"}),o.push({key:"features",label:P.features,indicatorClass:r,lines:l})}if(s.news){const i=s.news,d=i.fast_startup_skipped?"bg-neutral-500":"bg-green-400",r=[];i.ingestion_lag_seconds!=null&&r.push({k:"lag",v:`lag ${Number(i.ingestion_lag_seconds).toFixed(0)}s`}),r.push({k:"count",v:`total ${i.total_articles??"-"}`}),o.push({key:"news",label:P.news,indicatorClass:d,lines:r})}if(s.drift){const i=s.drift,d=(i.drift_count??0)>0?"bg-amber-400":"bg-green-400",r=[];r.push({k:"cnt",v:`${i.drift_count??0}/${i.total??"-"}`}),i.top_feature&&r.push({k:"top",v:i.top_feature}),o.push({key:"drift",label:P.drift,indicatorClass:d,lines:r})}if(s.calibration_monitor){const i=s.calibration_monitor,d=i.recommend_retrain?"bg-amber-400":"bg-green-400",r=[];r.push({k:"abs",v:`abs ${i.abs_streak}`}),r.push({k:"rel",v:`rel ${i.rel_streak}`}),i.recommend_retrain&&r.push({k:"rec",v:"retrain!"}),o.push({key:"calib",label:P.calibration_monitor,indicatorClass:d,lines:r})}if(s.risk){const i=s.risk,d="bg-green-400",r=[],l=(u=i.current_equity)!=null&&u.toFixed?i.current_equity.toFixed(0):i.current_equity;r.push({k:"eq",v:`eq ${l}`}),i.drawdown_ratio!=null&&r.push({k:"dd",v:`dd ${(i.drawdown_ratio*100).toFixed(1)}%`}),o.push({key:"risk",label:P.risk,indicatorClass:d,lines:r})}return o}const ne={class:"grid grid-cols-2 md:grid-cols-6 gap-3 text-[11px]"},ae={class:"flex items-center justify-between"},ie={class:"font-medium"},re={class:"text-[10px] leading-tight text-neutral-400 min-h-[28px]"},oe={},le=W({...oe,__name:"SystemComponentGrid",props:{componentsRaw:{}},setup(s){const o=s,u=v(()=>se(o.componentsRaw));return(i,d)=>(f(),g("div",ne,[(f(!0),g(K,null,et(u.value,r=>(f(),g("div",{key:r.key,class:"p-2 rounded bg-neutral-700/40 space-y-1"},[t("div",ae,[t("span",ie,p(r.label),1),t("span",{class:q(["w-2 h-2 rounded-full",r.indicatorClass])},null,2)]),t("div",re,[(f(!0),g(K,null,et(r.lines,l=>(f(),g("div",{key:l.k},p(l.v),1))),128))])]))),128))]))}}),ue={class:"font-semibold tracking-wide uppercase text-[10px] mt-0.5"},de={class:"flex-1 space-y-0.5"},ce={class:"text-sm font-medium"},fe={key:0,class:"opacity-80 leading-relaxed whitespace-pre-line"},me={},pe=W({...me,__name:"AlertBanner",props:{type:{default:"info"},title:{},description:{default:""},dismissible:{type:Boolean,default:!1}},emits:["close"],setup(s,{emit:o}){const u=o,i=s,d=v(()=>i.type==="warning"?"bg-amber-500/10 border-amber-500/40 text-amber-300":i.type==="danger"?"bg-brand-danger/10 border-brand-danger/40 text-brand-danger":"bg-neutral-700/30 border-neutral-600/50 text-neutral-200"),r=v(()=>i.type==="warning"?"주의":i.type==="danger"?"위험":"정보");return(l,k)=>(f(),g("div",{class:q([d.value,"w-full rounded border px-3 py-2 text-xs flex gap-2 items-start"])},[t("div",ue,p(r.value),1),t("div",de,[t("div",ce,p(s.title),1),s.description?(f(),g("div",fe,p(s.description),1)):L("",!0),zt(l.$slots,"default")]),s.dismissible?(f(),g("button",{key:0,onClick:k[0]||(k[0]=$=>u("close")),class:"opacity-60 hover:opacity-100","aria-label":"닫기"},"✕")):L("",!0)],2))}}),ge={key:0,class:"flex flex-wrap gap-2 items-center mt-1"},be={class:"text-[10px] text-neutral-300"},_e={key:0},ye=["disabled"],ve={key:0,class:"animate-pulse"},he={key:1},xe={key:1,class:"mt-2 text-[10px] text-amber-300"},ke={},we=W({...ke,__name:"FastStartupAlert",props:{fast:{},ingestionEnabled:{type:[Boolean,null]},ingestionRunning:{type:[Boolean,null]},upgradeLoading:{type:Boolean}},emits:["upgrade"],setup(s,{emit:o}){const u=s,i=o;function d(){i("upgrade")}const r=v(()=>u.fast?!!(u.ingestionEnabled&&u.ingestionRunning===!1&&u.fast.fast_startup):!1),l=v(()=>{var h;return(h=u.fast)!=null&&h.fast_startup?"warning":"info"}),k=v(()=>{var h;return(h=u.fast)!=null&&h.fast_startup?"Fast Startup 모드 활성":"시스템 알림"}),$=v(()=>{var h;return(h=u.fast)!=null&&h.fast_startup?"일부 백그라운드 태스크가 아직 기동되지 않았습니다. 업그레이드 실행으로 즉시 시작할 수 있습니다.":""});function F(h){return{ingestion_ws:"OHLCV Ingestion",feature_scheduler:"Feature Scheduler",model_training:"Model Training",calibration_monitor:"Calibration Monitor",risk_loop:"Risk Loop",news_ingestion:"News Ingestion"}[h]||h}return(h,a)=>r.value?(f(),xt(pe,{key:0,type:l.value,title:k.value,description:$.value},{default:st(()=>{var b,_,A,S,D,V;return[(b=s.fast)!=null&&b.fast_startup?(f(),g("div",ge,[a[1]||(a[1]=t("span",{class:"px-2 py-0.5 rounded bg-neutral-600/50 text-[10px] tracking-wide uppercase"},"FAST_STARTUP",-1)),t("span",be,[a[0]||(a[0]=M(" 생략 컴포넌트: ",-1)),(A=(_=s.fast)==null?void 0:_.skipped_components)!=null&&A.length?(f(!0),g(K,{key:0},et(s.fast.skipped_components,(j,N)=>(f(),g("span",{key:j},[M(p(F(j)),1),N<s.fast.skipped_components.length-1?(f(),g("span",_e,", ")):L("",!0)]))),128)):(f(),g(K,{key:1},[M("-")],64))]),t("button",{class:"btn btn-xs",disabled:s.upgradeLoading||!((S=s.fast)!=null&&S.upgrade_possible),onClick:d},[s.upgradeLoading?(f(),g("span",ve,"업그레이드...")):(f(),g("span",he,"업그레이드 실행"))],8,ye)])):L("",!0),(V=(D=s.fast)==null?void 0:D.degraded_components)!=null&&V.length?(f(),g("div",xe," 느려진(Degraded): "+p(s.fast.degraded_components.join(", ")),1)):L("",!0)]}),_:1},8,["type","title","description"])):L("",!0)}});function it(s,o){const u=[],i=[];if(!s||typeof s!="object")return{warnings:[],errors:["응답 형식 오류: 객체가 아닙니다"]};if(o.required)for(const d of o.required)Object.prototype.hasOwnProperty.call(s,d)||u.push(`필수 필드 없음: ${d}`);if(o.types)for(const[d,r]of Object.entries(o.types)){if(!(d in s))continue;const l=s[d],k=Array.isArray(l)?"array":typeof l;k!==r&&u.push(`필드 타입 불일치: ${d} (기대: ${r}, 실제: ${k})`)}if(o.ranges)for(const[d,r]of Object.entries(o.ranges)){const l=s[d];typeof l=="number"&&(r.min!=null&&l<r.min&&u.push(`값 최소 범위 위반: ${d} (${l} < ${r.min})`),r.max!=null&&l>r.max&&u.push(`값 최대 범위 위반: ${d} (${l} > ${r.max})`),Number.isFinite(l)||i.push(`숫자 값 비정상: ${d}=${l}`))}if(o.arrayShape)for(const[d,r]of Object.entries(o.arrayShape)){const l=s[d];if(Array.isArray(l))for(let k=0;k<Math.min(l.length,3);k++){const $=l[k];if(!$||typeof $!="object"){u.push(`${d}[${k}] 객체 아님`);continue}if(r.required)for(const F of r.required)Object.prototype.hasOwnProperty.call($,F)||u.push(`${d}[${k}] 필수 필드 없음: ${F}`);if(r.types)for(const[F,h]of Object.entries(r.types)){if(!(F in $))continue;const a=$[F],b=Array.isArray(a)?"array":typeof a;b!==h&&u.push(`${d}[${k}].${F} 타입 불일치 (기대:${h}, 실제:${b})`)}}}return{warnings:u,errors:i}}const $e={required:["overall","components"],types:{overall:"string",components:"object"}},Se={required:["decisions_5m","decisions_1m","auto_loop_enabled"],types:{decisions_5m:"number",decisions_1m:"number",auto_loop_enabled:"boolean"},ranges:{decisions_5m:{min:0},decisions_1m:{min:0}}},Le={required:["status","count","items"],types:{status:"string",count:"number",items:"array"},ranges:{count:{min:0}},arrayShape:{items:{required:["created_at","decision"],types:{created_at:"number",probability:"number",decision:"number",threshold:"number",production:"boolean",model_name:"string",model_version:"string",auto:"boolean"}}}},wt=Jt("recentDecisions",{state:()=>({loading:!1,error:null,items:[],lastFetched:null,filters:{limit:50},emptyStreak:0}),getters:{normalized(s){return s.items.map(o=>({...o,decision:typeof o.decision=="number"?o.decision:typeof o.decision=="string"?Number(o.decision):null}))},decisionLabel(){return s=>s===1?"매수":s===-1?"매도":s===0?"유지":"-"}},actions:{setLimit(s){this.filters.limit=Math.min(500,Math.max(1,Math.floor(s)))},setAutoOnly(s){this.filters.auto_only=s,s&&(this.filters.manual_only=!1)},setManualOnly(s){this.filters.manual_only=s,s&&(this.filters.auto_only=!1)},async fetchRecent(){this.loading=!0,this.error=null;const s=nt();try{const o={limit:this.filters.limit};this.filters.auto_only&&(o.auto_only=!0),this.filters.manual_only&&(o.manual_only=!0);const i=(await tt.get("/api/inference/activity/recent",{params:o})).data,{warnings:d,errors:r}=it(i,Le);if(r.length){this.error=r.join(","),s.push({type:"error",message:`Recent decisions 오류: ${this.error}`});return}if(d.length&&s.push({type:"warning",message:`Recent decisions 경고: ${d.join(" | ")}`}),i.status!=="ok"){this.error=i.status,s.push({type:"error",message:`Recent decisions status=${i.status}`});return}const l=Array.isArray(i.items)?i.items:[];if(l.length===0){if(this.emptyStreak+=1,this.items.length>0&&this.emptyStreak<=2){this.lastFetched=Date.now();return}}else this.emptyStreak=0;const k=a=>{const b=a.created_at??0,_=a.model_name??"",A=a.model_version??"";return`${b}|${_}|${A}`},$=l.map(a=>k(a)),F=this.items.map(a=>a.uid||"");if($.length===F.length&&$.every((a,b)=>a===F[b]))for(let a=0;a<l.length;a++){const b=l[a],_=$[a];let A=this.items[a];if(!A||A.uid!==_){const S=this.items.find(D=>D.uid===_);S&&(A=S)}A?Object.assign(A,b):(b.uid=_,this.items[a]?this.items[a]=b:this.items.push(b))}else{const a=new Map;for(const _ of this.items)_&&_.uid&&a.set(_.uid,_);const b=[];for(const _ of l){const A=k(_),S=a.get(A);S?(Object.assign(S,_),b.push(S)):(_.uid=A,b.push(_))}this.items.splice(0,this.items.length,...b)}this.lastFetched=Date.now()}catch(o){this.error=(o==null?void 0:o.message)||"fetch_failed"}finally{this.loading=!1}}}}),je={class:"bg-neutral-900/60 border border-neutral-800 rounded-lg p-4 space-y-3",title:"최신 추론 결정 로그"},Ae={class:"flex items-center justify-between"},Fe={class:"flex items-center gap-2 text-[11px]"},Me={class:"flex items-center gap-1"},Ce={class:"flex items-center gap-1",title:"10초마다 자동 새로고침"},Re=["disabled"],De={key:0,class:"text-xs text-brand-danger"},Te={class:"overflow-x-auto -mx-2 px-2"},Oe={class:"w-full text-xs table-fixed"},Ie={class:"py-1 whitespace-nowrap"},Be=["title"],qe={class:"py-1 whitespace-nowrap"},Ne={class:"py-1 whitespace-nowrap"},Ue={class:"py-1 whitespace-nowrap"},Ve={class:"py-1 whitespace-nowrap"},Ee={class:"text-neutral-300"},Pe={key:0,class:"text-neutral-500 ml-1"},ze={class:"py-1 whitespace-nowrap"},Je={key:0,class:"px-1.5 py-0.5 rounded bg-emerald-600/30 text-emerald-300"},He={key:1,class:"px-1.5 py-0.5 rounded bg-neutral-700 text-neutral-300"},Ke={class:"text-[10px] text-neutral-500 flex justify-between"},We={name:"RecentDecisionsPanel"},Ge=W({...We,setup(s){const o=wt(),u=v(()=>o.loading),i=v(()=>o.error),d=v(()=>o.normalized),r=v(()=>o.lastFetched),l=I(o.filters.limit),k=I(!0);B(l,y=>{o.setLimit(y),F()});let $=null;function F(){$&&clearTimeout($),$=setTimeout(()=>h(),300)}function h(){o.fetchRecent()}let a=null;function b(){_(),a=setInterval(()=>{k.value&&!u.value&&h()},1e4)}function _(){a&&(clearInterval(a),a=null)}B(k,y=>{y&&h()}),kt(()=>{h(),b()}),H(()=>_());const A=v(()=>d.value);function S(y){return y===1?"매수":y===-1?"매도":y===0?"유지":String(y??"-")}function D(y){return y===1?"text-brand-accent font-semibold":y===-1?"text-brand-danger font-semibold":"text-neutral-400"}function V(y){return y==null||isNaN(y)?"-":(y*100).toFixed(2)+"%"}function j(y){return y==null||isNaN(y)?"-":(y*100).toFixed(1)+"%"}function N(y){if(!y)return"-";const x=Date.now()/1e3-y;return x<60?x.toFixed(0)+"s ago":x<3600?Math.floor(x/60)+"m ago":Math.floor(x/3600)+"h ago"}function z(y){return y?new Date(y*1e3).toLocaleString():"-"}return(y,x)=>(f(),g("div",je,[t("div",Ae,[x[5]||(x[5]=t("h3",{class:"font-semibold text-sm tracking-wide flex items-center gap-2"},[M(" 최근 결정 기록 "),t("span",{class:"text-[10px] text-neutral-400 font-normal",title:"매수=1, 매도=-1, 유지=0 / 확률·임계값은 모델 출력 기반"},"도움말")],-1)),t("div",Fe,[t("label",Me,[x[2]||(x[2]=t("span",null,"제한",-1)),U(t("input",{type:"number","onUpdate:modelValue":x[0]||(x[0]=w=>l.value=w),min:"1",max:"500",class:"w-16 bg-neutral-800 border border-neutral-700 rounded px-1 py-0.5"},null,512),[[at,l.value,void 0,{number:!0}]])]),t("label",Ce,[U(t("input",{type:"checkbox","onUpdate:modelValue":x[1]||(x[1]=w=>k.value=w)},null,512),[[Z,k.value]]),x[3]||(x[3]=M()),x[4]||(x[4]=t("span",null,"자동 새로고침",-1))]),t("button",{class:"btn !py-1 !px-2",onClick:h,disabled:u.value},p(u.value?"로딩중":"새로고침"),9,Re)])]),i.value?(f(),g("div",De,"Error: "+p(i.value),1)):L("",!0),t("div",Te,[t("table",Oe,[x[7]||(x[7]=t("thead",{class:"text-neutral-500"},[t("tr",{class:"border-b border-neutral-800"},[t("th",{class:"py-1 font-medium text-left w-[120px]",title:"결정이 이루어진 시간"},"시간"),t("th",{class:"py-1 font-medium text-left w-[72px]",title:"모델에 의해 내려진 결정"},"결정"),t("th",{class:"py-1 font-medium text-left w-[90px]",title:"결정의 확률 (0~1)"},"확률"),t("th",{class:"py-1 font-medium text-left w-[90px]",title:"결정을 내리기 위한 임계값 (0~1)"},"임계값"),t("th",{class:"py-1 font-medium text-left w-[200px]",title:"사용된 모델의 이름"},"모델"),t("th",{class:"py-1 font-medium text-left w-[96px]",title:"프로덕션 여부"},"프로덕션")])],-1)),t("tbody",null,[(f(!0),g(K,null,et(A.value,w=>(f(),g("tr",{key:w.uid,class:"border-b border-neutral-800/40 hover:bg-neutral-800/40"},[t("td",Ie,[t("span",{title:z(w.created_at)},p(N(w.created_at)),9,Be)]),t("td",qe,[t("span",{class:q(D(w.decision))},p(S(w.decision)),3)]),t("td",Ne,p(V(w.probability)),1),t("td",Ue,p(j(w.threshold)),1),t("td",Ve,[t("span",Ee,p(w.model_name||"-"),1),w.model_version?(f(),g("span",Pe,"v"+p(w.model_version),1)):L("",!0)]),t("td",ze,[w.production?(f(),g("span",Je,"프로덕션")):(f(),g("span",He,"-"))])]))),128)),U(t("tr",null,[...x[6]||(x[6]=[t("td",{colspan:"6",class:"text-center py-6 text-neutral-500"},"결정 없음",-1)])],512),[[Ht,A.value.length===0]])])])]),t("div",Ke,[t("div",null,"가져온 시간: "+p(r.value?new Date(r.value).toLocaleTimeString():"-"),1),t("div",null,"총계: "+p(d.value.length),1)])]))}}),Qe=Zt(Ge,[["__scopeId","data-v-32823a41"]]),Xe={class:"space-y-6"},Ye={class:"card"},Ze={class:"text-lg font-semibold mb-2 flex items-center gap-2"},ts={key:0,class:"inline-block w-3 h-3 rounded-full border-2 border-t-transparent border-brand-accent animate-spin"},es={key:0,class:"space-y-3 opacity-50"},ss={key:1,class:"space-y-3"},ns={class:"flex flex-wrap gap-2 text-[11px] items-center"},as={key:0,class:"px-2 py-0.5 rounded bg-neutral-600/60 border border-neutral-500/40"},is={class:"text-neutral-400"},rs={key:1,class:"text-neutral-400"},os={class:"flex items-center gap-3 text-[10px]"},ls=["disabled"],us={class:"flex items-center gap-1 cursor-pointer"},ds={key:0,class:"text-neutral-500"},cs={class:"text-[10px] opacity-70 max-h-48 overflow-auto"},fs={class:"card"},ms={class:"mt-4 p-3 rounded bg-neutral-800/40 border border-neutral-700/40 space-y-3",title:"최근 1/5분 결정 빈도와 자동 루프 상태를 모니터링"},ps={class:"flex items-center justify-between"},gs={class:"text-sm font-semibold flex items-center gap-2"},bs={class:"flex items-center gap-2 text-[10px]"},_s=["disabled"],ys={key:0,class:"inline-block w-3 h-3 rounded-full border-2 border-t-transparent border-brand-accent animate-spin"},vs={class:"flex items-center gap-1 cursor-pointer select-none"},hs={key:1,class:"text-neutral-500"},xs={key:0,class:"text-xs text-neutral-400 animate-pulse"},ks={key:1,class:"grid grid-cols-2 md:grid-cols-6 gap-3 text-[11px]"},ws={class:"mt-6"},$s={class:"mt-4 grid grid-cols-2 md:grid-cols-6 gap-4 text-sm"},Ss={class:"p-3 rounded bg-neutral-700/40 flex flex-col justify-between"},Ls={class:"p-3 rounded bg-neutral-700/40 flex flex-col justify-between"},js={class:"p-3 rounded bg-neutral-700/40 flex flex-col justify-between"},As={class:"font-semibold"},Fs={class:"p-3 rounded bg-neutral-700/40 flex flex-col justify-between"},Ms={class:"font-semibold"},Cs={class:"p-3 rounded bg-neutral-700/40 flex flex-col justify-between"},Rs={class:"text-neutral-400 flex items-center justify-between"},Ds={key:0,class:"text-xs px-1 rounded bg-brand-danger/20 text-brand-danger"},Ts={class:"font-semibold"},Os={class:"mt-1"},Is=["d"],Bs={key:1,class:"h-6"},qs={class:"p-3 rounded bg-neutral-700/40 flex flex-col justify-between"},Ns={class:"text-neutral-400 flex items-center justify-between"},Us={class:"font-semibold"},Vs={class:"mt-2 h-2 w-full rounded bg-neutral-600 overflow-hidden"},Es={class:"mt-1 text-[10px] text-neutral-400"},Ps={class:"mt-4 flex flex-wrap items-center gap-3 text-xs"},zs=["disabled"],Js={class:"flex items-center gap-1 cursor-pointer select-none"},Hs={class:"flex items-center gap-1"},Ks={key:0,class:"text-neutral-400"},Ws={key:1,class:"px-2 py-0.5 rounded bg-brand-danger/20 text-brand-danger"},Gs={class:"mt-4 text-[10px] opacity-70 max-h-48 overflow-auto"},Qs={key:0,class:"mt-2 text-[10px] opacity-70 max-h-48 overflow-auto"},Xs=100,Ys=24,an=W({__name:"Dashboard",setup(s){const o=te(),{status:u,lag:i,stale:d,sparkPath:r,bufferFillRatio:l,bufferBarClass:k,flushAgeLabel:$,loading:F,error:h,lastUpdated:a,auto:b,intervalSec:_}=Kt(o);function A(){o.fetchStatus()}kt(()=>{o.fetchStatus(),lt(),V(),J(),rt(),Q(),St(),Ft()});const S=yt({fast_startup:!1,skipped_components:[],degraded_components:[],upgrade_possible:!1}),D=I(!1);async function V(){try{const{data:n}=await tt.get("/admin/fast_startup/status");Object.assign(S,n||{}),typeof S.fast_startup!="boolean"&&T.warn("fast_startup 필드 이상",typeof S.fast_startup),S.skipped_components&&!Array.isArray(S.skipped_components)&&T.warn("skipped_components 타입 이상",typeof S.skipped_components)}catch(n){T.error("Fast Startup 상태 조회 실패",(n==null?void 0:n.message)||"알 수 없는 오류")}}const j=yt({}),N=I(!1),z=I(null),y=I(!0),x=I(15),w=ee();async function J(){N.value=!0;try{const{data:n}=await tt.get("/api/system/status");Object.assign(j,n||{});const e=it(j,$e);e.errors.length&&T.error("System 응답 오류",e.errors.slice(0,2).join(`
`)),e.warnings.length&&T.warn("System 응답 경고",e.warnings.slice(0,2).join(`
`)),z.value=Date.now()}catch(n){T.error("System 상태 조회 실패",(n==null?void 0:n.message)||"알 수 없는 오류")}finally{N.value=!1}}function rt(){w.register({id:"system-status",interval:x.value*1e3,enabled:()=>y.value,immediate:!0,run:()=>J()})}function $t(){w.remove("system-status")}B(x,()=>rt()),B(y,n=>{n&&J()}),H(()=>{$t(),Rt(),ot(),Mt()});const m=Gt(),G=I(!0);function Q(){m.fetchSummary()}function St(){w.register({id:"trading-activity",interval:1e4,enabled:()=>G.value,immediate:!0,run:()=>Q()})}function ot(){w.remove("trading-activity")}B(G,n=>{n&&Q()}),B(()=>m.summary,n=>{if(!n)return;const e=it(n,Se);e.errors.length&&T.error("Trading Summary 오류",e.errors.slice(0,2).join(`
`)),e.warnings.length&&T.warn("Trading Summary 경고",e.warnings.slice(0,2).join(`
`)),n.disable_reason&&typeof n.disable_reason!="string"&&T.warn("disable_reason 형식 이상",typeof n.disable_reason)}),H(()=>ot());const Lt=wt(),jt=I(!0);function At(){Lt.fetchRecent()}function Ft(){w.register({id:"recent-decisions",interval:1e4,enabled:()=>jt.value,immediate:!0,run:()=>At()})}function Mt(){w.remove("recent-decisions")}const T=nt();B(()=>{var n;return(n=m.summary)==null?void 0:n.decisions_5m},n=>{n&&n>0});function Ct(){w.register({id:"idle-alert",interval:6e4,enabled:()=>!0,immediate:!1,run:()=>{var n;if((((n=m.summary)==null?void 0:n.decisions_5m)||0)===0&&m.idleStreakMinutes>=5){const e=Math.floor(m.idleStreakMinutes/5);window.__lastIdleBucket!==e&&(window.__lastIdleBucket=e,T.warn("Trading idle",`최근 ${m.idleStreakMinutes.toFixed(1)}분 의사결정 없음`))}}})}Ct(),H(()=>w.remove("idle-alert"));function lt(){w.register({id:"ingestion-status-dashboard",interval:_.value*1e3,enabled:()=>b.value===!0,immediate:!0,run:()=>o.fetchStatus()})}function Rt(){w.remove("ingestion-status-dashboard")}B(_,()=>lt()),B(b,n=>{n&&o.fetchStatus()});const Dt=v(()=>{if(!m.summary||!m.summary.last_decision_ts)return"-";const n=Date.now()/1e3-m.summary.last_decision_ts;return n<60?"<1m":n<3600?Math.floor(n/60)+"m":(n/3600).toFixed(1)+"h"}),Tt=v(()=>!m.summary||!m.summary.last_decision_ts?null:Date.now()/1e3-m.summary.last_decision_ts),Ot=v(()=>Qt(Tt.value??null)),It=v(()=>{var e;const n=((e=m.summary)==null?void 0:e.decisions_1m)||0;return n===0?"idle":n<2?"warning":"ok"}),Bt=v(()=>{var n;return Xt((n=m.summary)==null?void 0:n.decisions_5m)}),qt=v(()=>m.idleStreakMinutes>=10?"danger":m.idleStreakMinutes>=5?"warning":m.idleStreakMinutes===0?"neutral":"ok");v(()=>{var e;const n=((e=m.summary)==null?void 0:e.decisions_1m)||0;return n===0?"text-neutral-500":n<2?"text-amber-300":"text-green-400"}),v(()=>{var e;const n=((e=m.summary)==null?void 0:e.decisions_5m)||0;return n===0?"text-neutral-500":n<5?"text-amber-300":"text-green-400"}),v(()=>m.idleStreakMinutes>=10?"text-brand-danger":m.idleStreakMinutes>=5?"text-amber-300":"text-neutral-300");const Nt=v(()=>m.idleStreakMinutes?m.idleStreakMinutes.toFixed(1)+"m":"-"),ut=v(()=>m.summary?m.summary.decisions_5m===0?"idle":m.summary.decisions_5m<5?"warming":"active":"unknown"),Ut=v(()=>{const n=ut.value;return n==="active"?"ok":n==="warming"?"warning":n==="idle"?"idle":"unknown"}),dt=v(()=>{var n;return Yt((n=m.summary)==null?void 0:n.disable_reason)}),Vt=v(()=>{const n=j.overall;return n==="ok"?"bg-green-600/30 text-green-300":n==="degraded"?"bg-amber-600/30 text-amber-300":n==="error"?"bg-brand-danger/30 text-brand-danger":"bg-neutral-600/40 text-neutral-200"});async function Et(){var e;if(D.value)return;D.value=!0;const n=nt();try{const{data:C}=await tt.post("/admin/fast_startup/upgrade");(e=C.started)!=null&&e.length?n.success("Fast Startup 업그레이드 완료",`시작됨: ${C.started.join(", ")}`):n.info("변경 없음","이미 업그레이드 되었거나 시작할 항목이 없습니다"),await V(),await o.fetchStatus(),await J()}catch(C){const Y=(C==null?void 0:C.__friendlyMessage)||"업그레이드 실패";n.error(Y,"fast_startup/upgrade")}finally{D.value=!1}}const X=v(()=>m.compareIntervalWithEnv());v(()=>{if(!X.value)return"";const{backend:n,env:e,match:C}=X.value;return C===null?"":C?`간격 일치(${n}s)`:`간격 불일치: 서버 ${n??"-"}s / 설정 ${e??"-"}s`}),v(()=>X.value?X.value.match?"border-emerald-600/40 text-emerald-300 bg-emerald-600/10":"border-amber-600/40 text-amber-300 bg-amber-600/10":"");const Pt=v(()=>!!(j&&(j.overall||j.components&&Object.keys(j.components).length)));return(n,e)=>{var C,Y,ct,ft,mt,pt,gt,bt,_t;return f(),g("div",Xe,[t("section",Ye,[t("h2",Ze,[e[5]||(e[5]=M("시스템 상태 ",-1)),e[6]||(e[6]=t("span",{class:"text-[10px] text-neutral-400 font-normal",title:"실시간 핵심 구성요소 상태 및 Fast Startup 적용 여부"},"도움말",-1)),N.value?(f(),g("span",ts)):L("",!0)]),e[9]||(e[9]=t("div",{class:"text-xs text-neutral-400 mb-3"},"주요 컴포넌트 통합 상태 (/api/system/status)",-1)),Pt.value?(f(),g("div",ss,[t("div",ns,[t("span",{class:q(["px-2 py-0.5 rounded font-medium",Vt.value])},"OVERALL: "+p(j.overall||"-"),3),j.fast_startup?(f(),g("span",as,"FAST_STARTUP")):L("",!0),t("span",is,[e[7]||(e[7]=M("DB: ",-1)),t("span",{class:q((C=j.db)!=null&&C.has_pool?"text-brand-accent":"text-brand-danger")},p((Y=j.db)!=null&&Y.has_pool?"ok":"no-pool"),3)]),(ct=j.skipped_components)!=null&&ct.length?(f(),g("span",rs,"skipped: "+p(j.skipped_components.join(", ")),1)):L("",!0)]),O(le,{"components-raw":j.components},null,8,["components-raw"]),t("div",os,[t("button",{class:"btn btn-sm",onClick:J,disabled:N.value},"새로고침",8,ls),t("label",us,[U(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=R=>y.value=R),class:"accent-brand-primary"},null,512),[[Z,y.value]]),M(" 자동 "+p(x.value)+"s ",1)]),U(t("input",{type:"range",min:"5",max:"60","onUpdate:modelValue":e[1]||(e[1]=R=>x.value=R),class:"w-40"},null,512),[[at,x.value,void 0,{number:!0}]]),z.value?(f(),g("span",ds,p(new Date(z.value).toLocaleTimeString()),1)):L("",!0)]),t("details",cs,[e[8]||(e[8]=t("summary",{class:"cursor-pointer"},"raw system JSON",-1)),t("pre",null,p(j),1)])])):(f(),g("div",es,"초기 로딩 중..."))]),t("section",fs,[e[22]||(e[22]=t("h1",{class:"text-xl font-semibold mb-2 flex items-center gap-2"},[M("대시보드 "),t("span",{class:"text-[10px] text-neutral-400 font-normal",title:"주요 거래/추론 활동과 인프라 상태 요약"},"도움말")],-1)),e[23]||(e[23]=t("p",{class:"text-sm text-neutral-300"},"기본 상태 요약",-1)),t("div",ms,[t("div",ps,[t("div",gs,[e[10]||(e[10]=M(" Trading Activity ",-1)),O(ht,{status:(ft=c(m).summary)!=null&&ft.auto_loop_enabled?"ok":"idle"},{default:st(()=>{var R;return[M(p((R=c(m).summary)!=null&&R.auto_loop_enabled?"자동":"수동"),1)]}),_:1},8,["status"]),dt.value?(f(),xt(ht,{key:0,status:"warning"},{default:st(()=>[M("비활성: "+p(dt.value),1)]),_:1})):L("",!0)]),t("div",bs,[t("button",{class:"btn btn-xs",onClick:Q,disabled:c(m).refreshing},"갱신",8,_s),c(m).refreshing?(f(),g("span",ys)):L("",!0),t("label",vs,[U(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=R=>G.value=R),class:"accent-brand-primary"},null,512),[[Z,G.value]]),e[11]||(e[11]=M(" poll 10s ",-1))]),(mt=c(m).summary)!=null&&mt.interval?(f(),g("span",hs,"loop "+p(c(m).summary.interval)+"s",1)):L("",!0)])]),c(m).initialLoading?(f(),g("div",xs,"불러오는 중...")):L("",!0),c(m).summary?(f(),g("div",ks,[O(E,{label:"최근 결정 시각",value:Dt.value,status:Ot.value},null,8,["value","status"]),O(E,{label:"1분 결정 수",value:((pt=c(m).summary)==null?void 0:pt.decisions_1m)??"-",status:It.value},null,8,["value","status"]),O(E,{label:"5분 결정 수",value:((gt=c(m).summary)==null?void 0:gt.decisions_5m)??"-",status:Bt.value},null,8,["value","status"]),O(E,{label:"연속 유휴",value:Nt.value,status:qt.value},null,8,["value","status"]),O(E,{label:"자동 루프",value:(bt=c(m).summary)!=null&&bt.auto_loop_enabled?"on":"off",status:(_t=c(m).summary)!=null&&_t.auto_loop_enabled?"ok":"idle"},null,8,["value","status"]),O(E,{label:"활동 상태",value:ut.value,status:Ut.value},null,8,["value","status"])])):L("",!0)]),t("div",ws,[O(Qe)]),t("div",$s,[t("div",Ss,[e[12]||(e[12]=t("div",{class:"text-neutral-400"},"Enabled",-1)),t("div",{class:q(["font-semibold",c(u).enabled?"text-brand-accent":"text-neutral-500"])},p(c(u).enabled??"-"),3)]),t("div",Ls,[e[13]||(e[13]=t("div",{class:"text-neutral-400"},"Running",-1)),t("div",{class:q(["font-semibold",c(u).running?"text-brand-accent":"text-neutral-500"])},p(c(u).running??"-"),3)]),t("div",js,[e[14]||(e[14]=t("div",{class:"text-neutral-400"},"Total Msg",-1)),t("div",As,p(c(u).total_messages??"-"),1)]),t("div",Fs,[e[15]||(e[15]=t("div",{class:"text-neutral-400"},"Reconnect",-1)),t("div",Ms,p(c(u).reconnect_attempts??"-"),1)]),t("div",Cs,[t("div",Rs,[e[16]||(e[16]=t("span",null,"Lag (s)",-1)),c(d)?(f(),g("span",Ds,"STALE")):L("",!0)]),t("div",Ts,p(c(i)),1),t("div",Os,[c(r)?(f(),g("svg",{key:0,width:Xs,height:Ys},[t("path",{d:c(r),fill:"none",stroke:"#10b981","stroke-width":"2"},null,8,Is)])):(f(),g("div",Bs))])]),t("div",qs,[t("div",Ns,[e[17]||(e[17]=t("span",null,"Buffer",-1)),t("span",{class:q(["text-xs",c(l)>.8?"text-brand-danger":c(l)>.5?"text-amber-400":"text-brand-accent"])},p((c(l)*100).toFixed(0))+"%",3)]),t("div",Us,p(c(u).buffer_size??0)+"/"+p(c(u).batch_size??"-"),1),t("div",Vs,[t("div",{class:q(["h-full transition-all",c(k)]),style:Wt({width:(c(l)*100).toFixed(0)+"%"})},null,6)]),t("div",Es,"flush "+p(c($)),1)])]),t("div",Ps,[t("button",{class:"btn",onClick:A,disabled:c(F)},"수동 새로고침",8,zs),t("label",Js,[U(t("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=R=>vt(b)?b.value=R:null),class:"accent-brand-primary"},null,512),[[Z,c(b)]]),e[18]||(e[18]=M(" 자동 갱신 ",-1))]),t("div",Hs,[e[19]||(e[19]=M(" 간격 ",-1)),U(t("input",{type:"range",min:"2",max:"15","onUpdate:modelValue":e[4]||(e[4]=R=>vt(_)?_.value=R:null)},null,512),[[at,c(_),void 0,{number:!0}]]),t("span",null,p(c(_))+"s",1)]),c(a)?(f(),g("span",Ks,"갱신: "+p(new Date(c(a)).toLocaleTimeString()),1)):L("",!0),c(h)?(f(),g("span",Ws,"에러: "+p(c(h)),1)):L("",!0)]),O(we,{fast:S,"ingestion-enabled":c(u).enabled??null,"ingestion-running":c(u).running===void 0?null:c(u).running,"upgrade-loading":D.value,onUpgrade:Et},null,8,["fast","ingestion-enabled","ingestion-running","upgrade-loading"]),t("details",Gs,[e[20]||(e[20]=t("summary",{class:"cursor-pointer"},"raw status JSON",-1)),t("pre",null,p(c(u)),1)]),S?(f(),g("details",Qs,[e[21]||(e[21]=t("summary",{class:"cursor-pointer"},"fast_startup status",-1)),t("pre",null,p(S),1)])):L("",!0)])])}}});export{an as default};
