import{d as V,k as d,c as q,m as X,a as s,e as r,z as Y,b as n,f as c,n as E,t as a,p as z,E as G,F as P,r as A}from"./index-BtrOmqR2.js";import{C as J,c as I}from"./confirmPresets-CzcHK0BG.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"space-y-4"},Z={class:"flex items-center gap-3"},ee={key:0,class:"text-[10px] text-neutral-500 animate-pulse"},te={class:"flex items-center gap-1 text-[11px] text-neutral-400 ml-2"},oe={key:0,class:"text-xs text-rose-400 font-mono break-all"},ne={key:1,class:"space-y-3"},se={key:0,class:"p-3 border border-neutral-800 rounded bg-neutral-900/50"},re={class:"flex items-center justify-between mb-1"},ae={class:"flex items-center gap-2"},le={class:"text-[10px] text-neutral-500"},ie={class:"grid grid-cols-2 md:grid-cols-3 gap-2 text-[11px]"},ue={class:"text-neutral-400"},de={class:"text-neutral-200 font-mono"},ce={key:0,class:"mt-3 border-t border-neutral-800 pt-2"},pe={key:0,class:"text-[10px] text-rose-400 font-mono"},me={key:1},fe={class:"w-full text-[11px]"},ye={class:"py-1 pr-2 font-mono"},_e=["title"],ve={class:"py-1 pr-2 font-mono"},xe={class:"py-1 pr-2 font-mono"},he={class:"py-1 pr-2"},be=["onClick"],ge={key:0},we={class:"p-3 border border-neutral-800 rounded bg-neutral-900/40"},ke={class:"flex items-center justify-between mb-2"},Ce={class:"text-xs font-semibold text-neutral-200"},Ee={key:0,class:"text-[10px] px-2 py-0.5 rounded bg-neutral-800 text-neutral-200 border border-neutral-700"},Pe={class:"w-full text-[11px] border-collapse"},Te={class:"py-1 pr-2 font-mono"},$e={class:"py-1 pr-2"},Me=["title"],Ae={class:"py-1 pr-2 font-mono"},Ie={class:"py-1 pr-2 font-mono"},Se={class:"py-1 pr-2 font-mono"},De={key:0,title:"Baseline production model – delta N/A (현재 프로덕션 기준 모델이라 Δ 값 없음)"},He={key:1},Ke={key:0,title:"Baseline production model – delta N/A (현재 프로덕션 기준 모델이라 Δ 값 없음)"},Ne={key:1},Re={class:"py-1 pr-2"},je={key:0,class:"text-[10px] px-1 py-0.5 rounded bg-neutral-700/40 text-neutral-400",title:"현재 기준(baseline) 모델"},Ue={key:0,class:"text-[10px] px-1 py-0.5 rounded bg-emerald-600/30 text-emerald-300 font-mono",title:"승격 추천: 기준 임계치 충족 (AUC↑ & ECE 허용 범위 내)"},Be=["title"],Fe={class:"py-1 pr-2"},Le=["onClick","disabled","title"],Oe={key:0},Ve={key:1},qe=["onClick","disabled"],Xe={key:0},Ye=V({__name:"ModelsSummary",setup(ze){const m=d(!0),f=d(null),T=d(!1),y=d(null),b=d([]),_=d(null),i=d(null),g=d("direction"),u=d({open:!1,title:"",message:""});function $(t){u.value.title=t.title,u.value.message=t.message,u.value.requireText=t.requireText,u.value.delayMs=t.delayMs,u.value.onConfirm=async()=>{try{await t.onConfirm()}finally{u.value.open=!1}},u.value.open=!0}const v=d(!1),w=d([]),k=d(null);function S(t){if(!t)return"-";try{const o=new Date(t),e=(Date.now()-o.getTime())/1e3;return e<60?Math.floor(e)+"s ago":e<3600?Math.floor(e/60)+"m ago":e<86400?Math.floor(e/3600)+"h ago":o.toLocaleString()}catch{return t}}function x(t){return t==null?"-":typeof t=="number"?t.toFixed(3):t}function N(t){return t==null?"-":typeof t=="number"?Math.abs(t)<1e-4?t.toExponential(2):t.toFixed(4):t}const R=q(()=>{if(!y.value)return{};const t=y.value.metrics||{},o=["auc","ece","brier","accuracy"],e={};return o.forEach(l=>{t[l]!==void 0&&(e[l]=t[l])}),e});function D(t){return t==="bottom"?"bottom_predictor":"baseline_predictor"}async function p(){m.value=!0,f.value=null;try{const t=D(g.value),o=await fetch(`/api/models/summary?limit=6&name=${encodeURIComponent(t)}&model_type=supervised`,{headers:{"X-API-Key":window.API_KEY||"dev-key"}});if(!o.ok)throw new Error(`HTTP ${o.status}`);const e=await o.json();T.value=!!e.has_model,y.value=e.production||null,b.value=(e.recent||[]).map(l=>({...l,promotion_recommend:l.promotion_recommend??l.promote_recommend??!1}))}catch(t){f.value=t.message||String(t)}finally{m.value=!1}}function H(t){return t==null?"-":typeof t!="number"?t:(t>0?"+":"")+t.toFixed(4)}function K(t,o){return t==null||typeof t!="number"?"text-neutral-400":o?t>.01?"text-emerald-400":t<-.005?"text-rose-400":"text-neutral-300":t<-.002?"text-emerald-400":t>.004?"text-rose-400":"text-neutral-300"}function j(t){if(!t)return"기준 미충족";if(t==="criteria_met")return"기준 충족";if(t==="baseline_production")return"프로덕션 기준 모델";if(t==="no_production_baseline")return"비교 기준 없음";try{return t.split(",").slice(0,5).join(", ")}catch{return t}}X(()=>{p(),setInterval(p,3e4)});async function U(t){!t||!t.id||_.value===null&&$({...I.modelPromote(t.version),onConfirm:async()=>{_.value=t.id,i.value=null;try{const o=await fetch(`/api/models/${t.id}/promote`,{method:"POST",headers:{"X-API-Key":window.API_KEY||"dev-key"}});if(!o.ok)throw new Error(`HTTP ${o.status}`);const e=await o.json();e&&e.promoted?i.value=`버전 ${t.version} 승격 완료`:i.value=`승격 실패: ${e&&(e.reason||e.error)||"unknown"}`,await p()}catch(o){i.value=`승격 오류: ${(o==null?void 0:o.message)||String(o)}`}finally{_.value=null,window.setTimeout(()=>{i.value=null},4e3)}}})}function B(){v.value=!v.value,v.value&&w.value.length===0&&C()}async function C(){k.value=null;try{const t=D(g.value),o=await fetch(`/api/models/production/history?limit=8&name=${encodeURIComponent(t)}&model_type=supervised`,{headers:{"X-API-Key":window.API_KEY||"dev-key"}});if(!o.ok)throw new Error(`HTTP ${o.status}`);const e=await o.json();w.value=(e==null?void 0:e.rows)||[]}catch(t){k.value=(t==null?void 0:t.message)||String(t)}}async function F(t){!t||!t.id||$({...I.modelRollback(t.version),onConfirm:async()=>{try{const o=await fetch(`/api/models/${t.id}/rollback`,{method:"POST",headers:{"X-API-Key":window.API_KEY||"dev-key"}});if(!o.ok)throw new Error(`HTTP ${o.status}`);const e=await o.json();(e==null?void 0:e.status)==="ok"?(i.value=`프로덕션을 ${t.version} 으로 롤백했습니다`,await p(),await C()):i.value=`롤백 실패: ${e&&(e.reason||e.error)||"unknown"}`}catch(o){i.value=`롤백 오류: ${(o==null?void 0:o.message)||String(o)}`}finally{window.setTimeout(()=>{i.value=null},4e3)}}})}async function L(t){!t||!t.id||$({...I.modelDelete(t.version),onConfirm:async()=>{try{const o=await fetch(`/api/models/${t.id}`,{method:"DELETE",headers:{"X-API-Key":window.API_KEY||"dev-key"}});if(!o.ok)throw new Error(`HTTP ${o.status}`);const e=await o.json();(e==null?void 0:e.status)==="deleted"?(i.value=`버전 ${t.version} 삭제 완료`,await p(),v.value&&await C()):i.value=`삭제 실패: ${e&&(e.reason||e.error)||"unknown"}`}catch(o){i.value=`삭제 오류: ${(o==null?void 0:o.message)||String(o)}`}finally{window.setTimeout(()=>{i.value=null},4e3)}}})}return(t,o)=>(r(),s("div",W,[Y(J,{open:u.value.open,title:u.value.title,message:u.value.message,requireText:u.value.requireText,delayMs:u.value.delayMs,onConfirm:o[0]||(o[0]=e=>u.value.onConfirm&&u.value.onConfirm()),onCancel:o[1]||(o[1]=e=>u.value.open=!1)},null,8,["open","title","message","requireText","delayMs"]),n("div",Z,[o[5]||(o[5]=n("h2",{class:"text-sm font-semibold tracking-wide"},"Models",-1)),m.value?(r(),s("span",ee,"Loading...")):c("",!0),m.value?c("",!0):(r(),s("span",{key:1,class:E([T.value?"bg-emerald-600/20 text-emerald-300":"bg-rose-600/20 text-rose-300","px-2 py-0.5 rounded text-[10px] font-mono"])},a(T.value?"HAS_MODEL":"NO_MODEL"),3)),n("label",te,[o[4]||(o[4]=n("span",null,"타겟",-1)),z(n("select",{class:"input py-0.5","onUpdate:modelValue":o[2]||(o[2]=e=>g.value=e),onChange:p},[...o[3]||(o[3]=[n("option",{value:"direction"},"direction",-1),n("option",{value:"bottom"},"bottom",-1)])],544),[[G,g.value]])]),n("button",{onClick:p,class:"text-[10px] px-2 py-0.5 rounded bg-neutral-800 hover:bg-neutral-700 transition"},"↻")]),f.value?(r(),s("div",oe,a(f.value),1)):c("",!0),f.value?c("",!0):(r(),s("div",ne,[y.value?(r(),s("div",se,[n("div",re,[n("div",ae,[o[6]||(o[6]=n("div",{class:"text-xs font-semibold text-neutral-200"},"Production Model",-1)),n("span",le,"version: "+a(y.value.version),1)]),n("div",{class:"flex items-center gap-2"},[n("button",{onClick:B,class:"text-[10px] px-2 py-0.5 rounded bg-neutral-800 hover:bg-neutral-700 transition"},"History")])]),n("div",ie,[(r(!0),s(P,null,A(R.value,(e,l)=>(r(),s("div",{key:l,class:"flex justify-between gap-2 bg-neutral-800/40 px-2 py-1 rounded"},[n("span",ue,a(l),1),n("span",de,a(N(e)),1)]))),128))]),v.value?(r(),s("div",ce,[n("div",{class:"flex items-center justify-between mb-1"},[o[7]||(o[7]=n("div",{class:"text-[11px] text-neutral-300"},"Production History",-1)),n("button",{onClick:C,class:"text-[10px] px-2 py-0.5 rounded bg-neutral-800 hover:bg-neutral-700"},"↻")]),k.value?(r(),s("div",pe,a(k.value),1)):(r(),s("div",me,[n("table",fe,[o[9]||(o[9]=n("thead",null,[n("tr",{class:"text-neutral-400 text-left"},[n("th",{class:"py-1 pr-2 font-medium"},"Version"),n("th",{class:"py-1 pr-2 font-medium"},"Promoted"),n("th",{class:"py-1 pr-2 font-medium"},"AUC"),n("th",{class:"py-1 pr-2 font-medium"},"ECE"),n("th",{class:"py-1 pr-2 font-medium"},"Action")])],-1)),n("tbody",null,[(r(!0),s(P,null,A(w.value,e=>{var l,h;return r(),s("tr",{key:e.id,class:"border-t border-neutral-800/60"},[n("td",ye,a(e.version),1),n("td",{class:"py-1 pr-2 font-mono",title:e.promoted_at||e.created_at},a(S(e.promoted_at||e.created_at)),9,_e),n("td",ve,a(x((l=e.metrics)==null?void 0:l.auc)),1),n("td",xe,a(x((h=e.metrics)==null?void 0:h.ece)),1),n("td",he,[n("button",{onClick:M=>F(e),class:"text-[10px] px-2 py-0.5 rounded bg-amber-700 hover:bg-amber-600 text-white"},"Rollback",8,be)])])}),128)),w.value.length===0?(r(),s("tr",ge,[...o[8]||(o[8]=[n("td",{colspan:"5",class:"py-2 text-center text-neutral-500"},"No production history.",-1)])])):c("",!0)])])]))])):c("",!0)])):c("",!0),n("div",we,[n("div",ke,[n("div",Ce,"Recent Models ("+a(b.value.length)+")",1),i.value?(r(),s("div",Ee,a(i.value),1)):c("",!0)]),n("table",Pe,[o[11]||(o[11]=n("thead",null,[n("tr",{class:"text-neutral-400 text-left"},[n("th",{class:"py-1 pr-2 font-medium"},"Version"),n("th",{class:"py-1 pr-2 font-medium"},"Status"),n("th",{class:"py-1 pr-2 font-medium"},"Created"),n("th",{class:"py-1 pr-2 font-medium"},"AUC"),n("th",{class:"py-1 pr-2 font-medium"},"ECE"),n("th",{class:"py-1 pr-2 font-medium"},"Acc"),n("th",{class:"py-1 pr-2 font-medium"},"ΔAUC"),n("th",{class:"py-1 pr-2 font-medium"},"ΔECE"),n("th",{class:"py-1 pr-2 font-medium"},"Promote?"),n("th",{class:"py-1 pr-2 font-medium"},"Action")])],-1)),n("tbody",null,[(r(!0),s(P,null,A(b.value,e=>{var l,h,M;return r(),s("tr",{key:e.id,class:"border-t border-neutral-800/60 hover:bg-neutral-800/40"},[n("td",Te,a(e.version),1),n("td",$e,[n("span",{class:E(e.status==="production"?"text-emerald-400":"text-neutral-300")},a(e.status),3)]),n("td",{class:"py-1 pr-2 font-mono",title:e.created_at},a(S(e.created_at)),9,Me),n("td",Ae,a(x((l=e.metrics)==null?void 0:l.auc)),1),n("td",Ie,a(x((h=e.metrics)==null?void 0:h.ece)),1),n("td",Se,a(x((M=e.metrics)==null?void 0:M.accuracy)),1),n("td",{class:E(["py-1 pr-2 font-mono",e.status==="production"?"text-neutral-500":K(e.auc_delta,!0)])},[e.status==="production"?(r(),s("span",De,"-")):(r(),s("span",He,a(H(e.auc_delta)),1))],2),n("td",{class:E(["py-1 pr-2 font-mono",e.status==="production"?"text-neutral-500":K(e.ece_delta,!1)])},[e.status==="production"?(r(),s("span",Ke,"-")):(r(),s("span",Ne,a(H(e.ece_delta)),1))],2),n("td",Re,[e.status==="production"?(r(),s("span",je,"BASE")):(r(),s(P,{key:1},[e.promotion_recommend||e.promote_recommend?(r(),s("span",Ue,"RECOMMEND")):(r(),s("span",{key:1,class:"text-[10px] px-1 py-0.5 rounded bg-neutral-700/40 text-neutral-400 font-mono",title:j(e.promotion_recommend_reason)},"-",8,Be))],64))]),n("td",Fe,[e.status!=="production"?(r(),s("button",{key:0,onClick:O=>U(e),disabled:m.value||_.value===e.id,title:e.promotion_recommend||e.promote_recommend?"추천됨: 기준 충족":"수동 승격",class:"text-[10px] px-2 py-0.5 rounded bg-emerald-700 hover:bg-emerald-600 disabled:opacity-50 disabled:cursor-not-allowed text-white transition"},[_.value===e.id?(r(),s("span",Oe,"Promoting…")):(r(),s("span",Ve,"Promote"))],8,Le)):c("",!0),e.status!=="production"?(r(),s("button",{key:1,onClick:O=>L(e),disabled:m.value,class:"ml-2 text-[10px] px-2 py-0.5 rounded bg-rose-700 hover:bg-rose-600 text-white transition",title:"이 모델 레지스트리 레코드를 삭제(soft-delete)합니다"},"Delete",8,qe)):c("",!0)])])}),128)),b.value.length===0?(r(),s("tr",Xe,[...o[10]||(o[10]=[n("td",{colspan:"10",class:"py-4 text-center text-neutral-500"},"No models registered.",-1)])])):c("",!0)])])])]))]))}}),We=Q(Ye,[["__scopeId","data-v-3d130450"]]);export{We as default};
