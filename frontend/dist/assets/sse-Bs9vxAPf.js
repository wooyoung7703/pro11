function E(c,t){const M=c.url,f=c.heartbeatTimeoutMs??2e4,p=c.maxBackoffMs??15e3,i=c.initialBackoffMs??1e3;let e=null,l=!1,r=i,a=Date.now(),s=null;function u(){s&&clearInterval(s),s=null}function S(){u(),s=setInterval(()=>{if(Date.now()-a>f)try{e&&e.close()}catch{}},Math.max(1e3,Math.floor(f/2)))}function y(){if(l)return;try{e&&(e.close(),e=null)}catch{}e=new EventSource(M),S(),e.onopen=()=>{r=i,a=Date.now(),t.onOpen&&t.onOpen()},e.onerror=o=>{a=Date.now(),t.onError&&t.onError(o)},e.onmessage=o=>{a=Date.now();let m=o.type||o.event||"",n=null;try{n=o.data?JSON.parse(o.data):null}catch{n=o.data}n&&typeof n=="object"&&typeof n.type=="string"&&(m=n.type),t.onMessage&&t.onMessage({type:m||"message",data:n,raw:o})};const v=setInterval(()=>{(!e||e.readyState===EventSource.CLOSED)&&(clearInterval(v),l||h())},500)}function h(){if(!l){try{e&&e.close()}catch{}e=null,setTimeout(()=>{r=Math.min(p,Math.floor(r*2)),y()},r)}}return y(),{isConnected:()=>!!e&&e.readyState===EventSource.OPEN,lastMessageAt:()=>a,close:()=>{l=!0,u();try{e&&e.close()}catch{}e=null,t.onClose&&t.onClose()}}}export{E as c};
