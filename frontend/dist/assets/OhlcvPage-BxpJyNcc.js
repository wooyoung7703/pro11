const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/OhlcvMainChart-C-gAqANa.js","assets/index-BtrOmqR2.js","assets/index-BUiix5qQ.css","assets/ema-CMLzdVLO.js","assets/ohlcv-BSjv8p1h.js","assets/http-CilSfrpq.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/OhlcvMainChart-ojtEGJlS.css","assets/LightweightOhlcvChart-B84eNyYB.js","assets/LightweightOhlcvChart-BEtGhdCV.css","assets/GapOverlayMiniChart-B7eWcf7M.js","assets/GapOverlayMiniChart-DX_t8C1s.css"])))=>i.map(i=>d[i]);
import{k as c,c as J,l as xe,o as ve,d as ye,m as ue,M as _e,a as R,b as e,f as H,p as D,v as U,A as g,t as v,i as de,q as we,h as ke,K as Pe,J as se,z as Ce,n as le,F as ce,r as pe,N as Re,_ as ae,e as k}from"./index-BtrOmqR2.js";import{u as ie}from"./ohlcv-BSjv8p1h.js";import Se from"./http-CilSfrpq.js";import{_ as Oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={},Be=500,Me=1e4;function ze(y={}){const x=ie(),P=c(null),T=c(!1),s=c(!1),L=c(null),V=c(null),E=c(null),I=c(0),A=c(!1),S=c(null),_=c(null),d=[],i=[],r=J(()=>x.symbol),u=J(()=>x.interval);function p(...n){y.log!==!1&&console.log("[ohlcv-ws]",...n)}function z(){const n=(oe==null?void 0:oe.VITE_WS_BASE)||window.location.origin.replace(/^http/,"ws"),l=new URLSearchParams;return r.value&&l.set("symbol",r.value),u.value&&l.set("interval",u.value),y.includeOpen&&l.set("include_open","true"),`${n.replace(/\/$/,"")}/ws/ohlcv?${l.toString()}`}function O(){if(!u.value){p("interval 미설정 - 연결 보류");return}if(T.value||s.value)return;A.value=!1;const n=z();p("connecting",n),s.value=!0;try{const l=new WebSocket(n);P.value=l,l.onopen=()=>{s.value=!1,T.value=!0,I.value=0,E.value=null,p("connected")},l.onerror=a=>{E.value="ws_error",p("error",a)},l.onclose=a=>{p("closed",a.code,a.reason),T.value=!1,s.value=!1,P.value=null,A.value||B()},l.onmessage=a=>{L.value=Date.now();try{const m=JSON.parse(a.data);V.value=m.type,N(m)}catch(m){p("message parse error",m,a.data)}}}catch(l){s.value=!1,E.value=l.message||"connect_fail",p("connect exception",l),B()}}function B(){if(A.value)return;const n=I.value+1;I.value=n;const l=Math.min(Me,Be*2**(n-1));p(`reconnect in ${l}ms (attempt ${n})`),setTimeout(()=>{A.value||O()},l)}function F(){A.value=!0,P.value&&(T.value||s.value)&&P.value.close()}function N(n){switch(n.type){case"snapshot":return K(n);case"append":return X(n);case"repair":return j(n);case"partial_update":return $(n);case"partial_close":return Y(n);case"gap_detected":return C(n);case"gap_repaired":return b(n);default:p("unknown event",n)}}function K(n){p("snapshot",n.candles.length),x.candles=[...n.candles],S.value=null}function X(n){for(const Q of d)try{if(Q(n))return}catch(Z){p("append interceptor error",Z)}const l=n.candle,a=x.candles,m=a[a.length-1];!m||l.open_time>m.open_time?a.push(l):l.open_time===m.open_time&&(a[a.length-1]=l)}function j(n){for(const a of i)try{if(a(n))return}catch(m){p("repair interceptor error",m)}const l=x.candles;for(const a of n.candles){const m=l.findIndex(Q=>Q.open_time===a.open_time);m>=0?l[m]=a:l.push(a)}l.sort((a,m)=>a.open_time-m.open_time)}function $(n){const l=n.candle;if(!S.value||S.value.open_time!==l.open_time)S.value={...l,is_closed:!1};else{const a=S.value;a.high=Math.max(a.high,l.high),a.low=Math.min(a.low,l.low),a.close=l.close,l.volume!=null&&(a.volume=l.volume),l.trade_count!=null&&(a.trade_count=l.trade_count)}f()}function Y(n){const l=n.candle;S.value=null;const a=x.candles,m=a[a.length-1];!m||l.open_time>m.open_time?a.push({...l,is_closed:!0}):l.open_time===m.open_time&&(a[a.length-1]={...l,is_closed:!0})}function C(n){p("gap_detected",n.detail)}function b(n){p("gap_repaired",n.detail)}function f(){const n=S.value;if(!n)return;const l=x.candles,a=l[l.length-1];!a||n.open_time>a.open_time?l.push(n):n.open_time===a.open_time&&(l[l.length-1]=n)}xe(u,(n,l)=>{n&&n!==l&&(p("interval changed -> reconnect"),q())});function q(){F(),I.value=0,setTimeout(O,20)}ve(()=>{F()}),y.autoConnect&&O();function G(n){return d.push(n),()=>{const l=d.indexOf(n);l>=0&&d.splice(l,1)}}function W(n){return i.push(n),()=>{const l=i.indexOf(n);l>=0&&i.splice(l,1)}}return{connected:T,connecting:s,lastEventAt:L,lastEventType:V,lastError:E,latencyMs:_,reconnectAttempts:I,partialCandle:J(()=>S.value),connect:O,disconnect:F,reconnect:q,registerAppendInterceptor:G,registerRepairInterceptor:W}}function Le(){const y=ie(),x=ze({autoConnect:!1,includeOpen:!0,log:!0}),P=c(!1),T=c(null),s=[],L=c(0),V=c(0),E=c(0);x.registerAppendInterceptor(d=>P.value?(s.push({type:"append",candles:[d.candle]}),!0):!1),x.registerRepairInterceptor(d=>P.value?(s.push({type:"repair",candles:d.candles}),!0):!1);function I(d){const i=y.candles;for(const r of d){const u=i[i.length-1];!u||r.open_time>u.open_time?i.push(r):r.open_time===u.open_time&&(i[i.length-1]=r)}}function A(d){const i=y.candles;for(const r of d){const u=i.findIndex(p=>p.open_time===r.open_time);u>=0?i[u]=r:i.push(r)}i.sort((r,u)=>r.open_time-u.open_time)}async function S(){if(!y.candles.length)return;const d=(()=>{for(let i=y.candles.length-1;i>=0;i--)if(y.candles[i].is_closed!==!1)return y.candles[i].open_time;return null})();if(d!=null){P.value=!0,T.value=d;try{const r=(await Se.get("/api/ohlcv/delta",{params:{since:d,limit:1e3}})).data||{},u=r.candles||[],p=r.repairs||[];if(u.length&&(I(u),V.value+=u.length),p.length){const z=p.map(O=>O.candle).filter(Boolean);A(z),L.value+=z.length}_()}finally{P.value=!1}}}function _(){if(!s.length)return;const d=[],i=[];for(const r of s)r.type==="append"?d.push(...r.candles):r.type==="repair"&&i.push(...r.candles);s.length=0,d.length&&(d.sort((r,u)=>r.open_time-u.open_time),I(d),V.value+=d.length),i.length&&(i.sort((r,u)=>r.open_time-u.open_time),A(i),L.value+=i.length)}return{syncing:P,lastDeltaSince:T,appliedAppends:V,appliedRepairs:L,appliedPartialDrops:E,runDelta:S,flushBuffer:_,wsCtl:x}}function Ae(y,x){const{baseNotional:P,addRatio:T,maxLegs:s,cooldownSec:L,minPriceMovePct:V,feeRate:E,takeProfitPct:I}=x,A=x.trailingTakeProfitPct??0,S=x.maxHoldingBars??0,_=[];if(!y||y.length===0)return{trades:_,realizedPnl:0,realizedRoi:null,totalFees:0,closed:!1};let d=0,i=0,r=0,u=0,p=NaN,z=-1e12,O=P,B=NaN;const F=y[0],N=F.close,K=P/N,X=P*E;_.push({time:F.open_time,side:"buy",price:N,qty:K,notional:P,fee:X,leg:1,note:"initial"}),d=1,i+=K,r+=P,u+=X,p=N,z=Math.floor(F.open_time/1e3),B=N;for(let j=1;j<y.length;j++){const $=y[j],Y=Math.floor($.open_time/1e3),C=$.close;if(d<s){const W=Y-z>=L,l=(p>0?(p-C)/p:0)>=V;if(W&&l){const a=O*T;if(a>0){const m=a/C,Q=a*E;d+=1,_.push({time:$.open_time,side:"buy",price:C,qty:m,notional:a,fee:Q,leg:d,note:`scale-in x${T}`}),i+=m,r+=a,u+=Q,p=C,z=Y,O=a}}}C>B&&(B=C);const b=i*C,f=b*E,q=b-f-r-u,G=r>0?q/r:null;if(G!=null&&G>=I){const W=i*C,n=f;_.push({time:$.open_time,side:"sell",price:C,qty:i,notional:W,fee:n,leg:0,note:`TP ${Math.round(I*1e3)/10}%`}),u+=n;const l=W-n-r-(u-n);return{trades:_,realizedPnl:l,realizedRoi:r>0?l/r:null,totalFees:u,closed:!0}}if(A>0&&G!=null&&G>0&&B>0&&(B-C)/B>=A){const n=i*C,l=f;_.push({time:$.open_time,side:"sell",price:C,qty:i,notional:n,fee:l,leg:0,note:`TRAIL ${Math.round(A*1e3)/10}%`}),u+=l;const a=n-l-r-(u-l);return{trades:_,realizedPnl:a,realizedRoi:r>0?a/r:null,totalFees:u,closed:!0}}if(S>0&&j>=S){const n=i*C,l=f;_.push({time:$.open_time,side:"sell",price:C,qty:i,notional:n,fee:l,leg:0,note:`MAX-HOLD ${S} bars`}),u+=l;const a=n-l-r-(u-l);return{trades:_,realizedPnl:a,realizedRoi:r>0?a/r:null,totalFees:u,closed:!0}}}return{trades:_,realizedPnl:0,realizedRoi:null,totalFees:u,closed:!1,avgEntry:i>0?r/i:void 0,positionQty:i>0?i:void 0,positionCost:i>0?r:void 0}}function fe(y){return y.map(x=>({time:x.time,side:x.side,price:x.price}))}const Fe={class:"space-y-4"},Te={class:"flex flex-wrap gap-3 items-end"},Ee=["disabled"],Ie=["disabled"],De=["disabled"],Ve={key:0,class:"text-[10px] text-neutral-400 flex items-center gap-1"},Ue={key:0},Ne={key:1,class:"text-emerald-400"},$e={key:2,class:"text-red-400"},We={key:3},je={class:"grid lg:grid-cols-4 gap-4"},qe={class:"lg:col-span-3 space-y-4"},Ge={class:"p-3 rounded border border-neutral-800 bg-neutral-900/60 space-y-3 overflow-hidden"},Qe={class:"flex items-center gap-3"},He={class:"flex items-center gap-1 text-[10px] text-neutral-400"},Je={class:"p-3 rounded border border-neutral-800 bg-neutral-900/60 overflow-hidden"},Ke={class:"space-y-4"},Xe={class:"p-3 rounded border border-neutral-800 bg-neutral-900/60"},Ye={class:"stat"},Ze={key:0},et={key:1},tt={class:"p-3 rounded border border-neutral-800 bg-neutral-900/60"},lt={class:"text-[11px] space-y-1"},nt={class:"inline-block"},st={class:"inline-block"},at={class:"inline-block"},ot={class:"p-3 rounded border border-neutral-800 bg-neutral-900/60"},it={class:"grid grid-cols-2 gap-2 text-[11px]"},rt={class:"flex items-center gap-2"},ut={class:"flex items-center gap-2"},dt={class:"flex items-center gap-2"},ct={class:"flex items-center gap-2"},pt={class:"flex items-center gap-2"},ft={class:"flex items-center gap-2"},vt={class:"flex items-center gap-2"},mt={class:"flex items-center gap-2"},ht={class:"flex items-center gap-2"},bt={class:"flex items-center gap-2 col-span-2"},gt={class:"mt-2 flex items-center gap-2"},xt=["disabled"],yt=["disabled"],_t={key:0,class:"text-[10px] text-neutral-500"},wt={key:1,class:"text-[10px] text-neutral-500"},kt={class:"mt-2 max-h-48 overflow-auto"},Pt={class:"w-full text-[10px] border-collapse"},Ct={class:"p-1"},Rt={class:"p-1 text-right"},St={class:"p-1 text-right"},Ot={class:"p-1 text-right"},Bt={class:"p-1 text-right"},Mt={class:"p-1"},zt={key:0},Lt={class:"p-3 rounded border border-neutral-800 bg-neutral-900/60"},At={class:"flex items-center justify-between"},Ft={class:"flex items-center gap-2"},Tt=["disabled"],Et={key:0,class:"text-[10px] text-neutral-500"},It={class:"mt-2 max-h-48 overflow-auto"},Dt={class:"w-full text-[10px] border-collapse"},Vt=["onClick"],Ut={class:"p-1"},Nt={class:"p-1"},$t={class:"p-1"},Wt={class:"p-1 text-right"},jt={class:"p-1 text-right"},qt={class:"p-1 text-right"},Gt=["onClick"],Qt={key:0},Ht=ye({__name:"OhlcvPage",setup(y){const x=se(()=>ae(()=>import("./OhlcvMainChart-C-gAqANa.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),P=se(()=>ae(()=>import("./LightweightOhlcvChart-B84eNyYB.js"),__vite__mapDeps([8,4,1,2,5,3,6,9]))),T=se(()=>ae(()=>import("./GapOverlayMiniChart-B7eWcf7M.js"),__vite__mapDeps([10,4,1,2,5,6,11]))),s=ie(),{wsCtl:L,runDelta:V,syncing:E,lastDeltaSince:I,appliedAppends:A,appliedRepairs:S}=Le(),_=c(!0),d=c(!1),i=c(null),r=c(null),u=c(800),p=c(800);let z=null,O=null,B=null,F=!1;function N(){if(i.value){const h=i.value.clientWidth;h&&h!==u.value&&(u.value=h)}if(r.value){const h=r.value.clientWidth;h&&h!==p.value&&(p.value=h)}}function K(){s.fetchRecent()}function X(){L.connected.value?L.disconnect():L.connect()}const j=J(()=>L.connected.value?"On":"Off"),$=J(()=>{const h=s.yearBackfill;if(!h||h.eta_seconds==null)return"";const t=Math.round(h.eta_seconds);if(t<60)return t+"s";const M=Math.floor(t/60),o=t%60;return M+"m"+(o>0?o+"s":"")});function Y(){s.startYearBackfill()}async function C(){if(!d.value){d.value=!0;try{await(await fetch(`/api/ohlcv/gaps/fill?symbol=${encodeURIComponent(s.symbol)}&interval=${encodeURIComponent(s.interval)}`,{method:"POST"})).json(),await s.fetchRecent(),await s.fetchGaps(),await s.fetchMeta()}catch{}finally{d.value=!1}}}ue(()=>{s.initDefaults("XRPUSDT","1m"),s.fetchRecent({includeOpen:!0}),s.fetchMeta(),L.connect(),setTimeout(()=>{V()},1e3);try{O&&clearInterval(O),O=setInterval(async()=>{if(!F){F=!0;try{await s.fetchRecent({includeOpen:!0,limit:Math.max(120,s.limit)}),V()}finally{F=!1}}},18e3),B&&clearInterval(B),B=setInterval(async()=>{if(!F){F=!0;try{await s.fetchRecent({includeOpen:!1,limit:Math.max(120,s.limit)}),V()}finally{F=!1}}},3e4)}catch{}_e(()=>{N(),typeof window<"u"&&"ResizeObserver"in window?(z=new ResizeObserver(()=>N()),i.value&&z.observe(i.value),r.value&&z.observe(r.value)):typeof window<"u"&&window.addEventListener("resize",N)})}),ve(()=>{z?(z.disconnect(),z=null):typeof window<"u"&&window.removeEventListener("resize",N),O&&clearInterval(O),O=null,B&&clearInterval(B),B=null});const b=c({baseNotional:100,addRatio:1,maxLegs:20,cooldownSec:120,minPriceMovePct:.005,feeRate:.001,takeProfitPct:.01,trailingTakeProfitPct:0,maxHoldingBars:0}),f=c({trades:[],realizedPnl:0,realizedRoi:null,totalFees:0,closed:!1}),q=c([]),G=J(()=>f.value.trades.filter(h=>h.side==="buy").length),W=J(()=>f.value.realizedRoi!=null?(f.value.realizedRoi*100).toFixed(2)+"%":"-");function n(){const h=s.candles.map(t=>({open_time:t.open_time,close_time:t.close_time,open:t.open,high:t.high,low:t.low,close:t.close,volume:t.volume}));f.value=Ae(h,b.value),q.value=fe(f.value.trades)}const l=c(!1),a=c(null),m=c("");async function Q(){if(!(!f.value.trades.length||!s.candles.length)&&!l.value){l.value=!0,a.value=null,m.value="";try{const h=s.candles[0].open_time,t=s.candles[s.candles.length-1].open_time,M={symbol:s.symbol,interval:s.interval,params:b.value,trades:f.value.trades,summary:{realizedPnl:f.value.realizedPnl,realizedRoi:f.value.realizedRoi,totalFees:f.value.totalFees,closed:f.value.closed,avgEntry:f.value.avgEntry??null,positionQty:f.value.positionQty??null,positionCost:f.value.positionCost??null},first_open_time:h,last_open_time:t,label:te.value||"DCA run"},w=await(await fetch("/api/sim/dca/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(M)})).json();w&&w.status==="ok"?(a.value=!0,m.value=`saved #${w.id}`):(a.value=!1,m.value=w&&w.error?`save failed: ${w.error}`:"save failed")}catch{a.value=!1,m.value="save failed"}finally{l.value=!1}}}const Z=c([]),ee=c(!1),ne=c(null),te=c("");async function re(){if(!ee.value){ee.value=!0;try{const h=new URLSearchParams({symbol:s.symbol,interval:s.interval,limit:String(20)}).toString(),M=await(await fetch(`/api/sim/dca/list?${h}`)).json();Z.value=M&&M.status==="ok"&&Array.isArray(M.items)?M.items:[]}catch{Z.value=[]}finally{ee.value=!1}}}async function me(h){try{const M=await(await fetch(`/api/sim/dca/${h}`)).json();if(!M||M.status!=="ok"||!M.data)return;const o=M.data;o.params&&(b.value={...b.value,...o.params});const w=o.summary||{};f.value={trades:o.trades||[],realizedPnl:w.realizedPnl??0,realizedRoi:w.realizedRoi??null,totalFees:w.totalFees??0,closed:w.closed??!1,avgEntry:w.avgEntry??void 0,positionQty:w.positionQty??void 0,positionCost:w.positionCost??void 0},q.value=fe(f.value.trades),ne.value=h,te.value=o.label||""}catch{}}function he(h){ne.value=h.id,te.value=h.label||""}ue(()=>{re()});function be(h){if(!Array.isArray(h))return 0;try{return h.filter(t=>t&&t.side==="buy").length}catch{return 0}}return(h,t)=>{var M;return k(),R("div",Fe,[e("div",Te,[e("div",null,[t[13]||(t[13]=e("label",{class:"lbl"},"Interval",-1)),D(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>g(s).interval=o),class:"inp w-24",placeholder:"1m"},null,512),[[U,g(s).interval]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"lbl"},"Limit",-1)),D(e("input",{type:"number","onUpdate:modelValue":t[1]||(t[1]=o=>g(s).limit=o),class:"inp w-24",min:"50",max:"1000"},null,512),[[U,g(s).limit,void 0,{number:!0}]])]),e("button",{class:"btn-xs h-8",onClick:K,disabled:g(s).loading},"Refresh",8,Ee),e("button",{class:"btn-xs h-8",onClick:X},"WS: "+v(j.value),1),e("button",{class:"btn-xs h-8",onClick:C,disabled:d.value},"Gaps",8,Ie),e("button",{class:"btn-xs h-8",onClick:Y,disabled:g(s).yearBackfillPolling},"Year Backfill",8,De),g(s).yearBackfill?(k(),R("div",Ve,[e("span",null,v((g(s).yearBackfill.percent||0).toFixed(1))+"%",1),g(s).yearBackfill.status==="running"?(k(),R("span",Ue,"⏳")):g(s).yearBackfill.status==="success"?(k(),R("span",Ne,"✔")):g(s).yearBackfill.status==="error"?(k(),R("span",$e,"✖")):H("",!0),$.value?(k(),R("span",We,"ETA "+v($.value),1)):H("",!0)])):H("",!0)]),e("div",je,[e("div",qe,[e("div",Ge,[e("div",Qe,[t[16]||(t[16]=e("h2",{class:"title mb-0"},"Main Chart",-1)),e("label",He,[D(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=o=>_.value=o),class:"align-middle"},null,512),[[we,_.value]]),t[15]||(t[15]=de(" Lightweight ",-1))])]),e("div",{ref_key:"mainChartBox",ref:i,class:"chart-wrapper",style:{height:"430px"}},[(k(),ke(Pe(_.value?g(P):g(x)),{width:u.value,height:430,initialBars:140,tradeMarkers:q.value},null,8,["width","tradeMarkers"]))],512)]),e("div",Je,[t[17]||(t[17]=e("h2",{class:"title flex items-center gap-2"},[de("Gap Overlay "),e("small",{class:"text-[10px] text-neutral-500"},"(Mini)")],-1)),e("div",{ref_key:"miniChartBox",ref:r,class:"chart-wrapper",style:{height:"70px"}},[Ce(g(T),{width:p.value,height:70},null,8,["width"])],512)])]),e("div",Ke,[e("div",Xe,[t[22]||(t[22]=e("h2",{class:"title"},"Stats",-1)),e("dl",Ye,[e("div",null,[t[18]||(t[18]=e("dt",null,"Candles",-1)),e("dd",null,v(g(s).candles.length),1)]),e("div",null,[t[19]||(t[19]=e("dt",null,"Open Gaps",-1)),e("dd",null,v(g(s).openGapCount),1)]),e("div",null,[t[20]||(t[20]=e("dt",null,"365d Comp",-1)),e("dd",null,v(g(s).completeness365d!=null?(g(s).completeness365d*100).toFixed(3)+"%":"-"),1)]),e("div",null,[t[21]||(t[21]=e("dt",null,"Last Range",-1)),g(s).range?(k(),R("dd",Ze,v(g(s).range.low.toFixed(4))+" ~ "+v(g(s).range.high.toFixed(4)),1)):(k(),R("dd",et,"-"))])])]),e("div",tt,[t[27]||(t[27]=e("h2",{class:"title"},"Delta/WS",-1)),e("dl",lt,[e("div",null,[t[23]||(t[23]=e("dt",{class:"text-neutral-500 inline-block w-24"},"Syncing",-1)),e("dd",{class:le(["inline-block",g(E)?"text-amber-400":"text-emerald-400"])},v(g(E)?"yes":"no"),3)]),e("div",null,[t[24]||(t[24]=e("dt",{class:"text-neutral-500 inline-block w-24"},"Last Delta",-1)),e("dd",nt,v(g(I)||"-"),1)]),e("div",null,[t[25]||(t[25]=e("dt",{class:"text-neutral-500 inline-block w-24"},"Appends",-1)),e("dd",st,v(g(A)),1)]),e("div",null,[t[26]||(t[26]=e("dt",{class:"text-neutral-500 inline-block w-24"},"Repairs",-1)),e("dd",at,v(g(S)),1)])])]),e("div",ot,[t[40]||(t[40]=e("h2",{class:"title"},"DCA Simulator",-1)),e("div",it,[e("label",rt,[t[28]||(t[28]=e("span",{class:"w-28 text-neutral-500"},"base notional",-1)),D(e("input",{class:"inp w-full",type:"number",min:"0",step:"0.01","onUpdate:modelValue":t[3]||(t[3]=o=>b.value.baseNotional=o)},null,512),[[U,b.value.baseNotional,void 0,{number:!0}]])]),e("label",ut,[t[29]||(t[29]=e("span",{class:"w-28 text-neutral-500"},"add ratio",-1)),D(e("input",{class:"inp w-full",type:"number",min:"0",step:"0.05","onUpdate:modelValue":t[4]||(t[4]=o=>b.value.addRatio=o)},null,512),[[U,b.value.addRatio,void 0,{number:!0}]])]),e("label",dt,[t[30]||(t[30]=e("span",{class:"w-28 text-neutral-500"},"max legs",-1)),D(e("input",{class:"inp w-full",type:"number",min:"1",step:"1","onUpdate:modelValue":t[5]||(t[5]=o=>b.value.maxLegs=o)},null,512),[[U,b.value.maxLegs,void 0,{number:!0}]])]),e("label",ct,[t[31]||(t[31]=e("span",{class:"w-28 text-neutral-500"},"cooldown(s)",-1)),D(e("input",{class:"inp w-full",type:"number",min:"0",step:"1","onUpdate:modelValue":t[6]||(t[6]=o=>b.value.cooldownSec=o)},null,512),[[U,b.value.cooldownSec,void 0,{number:!0}]])]),e("label",pt,[t[32]||(t[32]=e("span",{class:"w-28 text-neutral-500"},"min move %",-1)),D(e("input",{class:"inp w-full",type:"number",min:"0",step:"0.001","onUpdate:modelValue":t[7]||(t[7]=o=>b.value.minPriceMovePct=o)},null,512),[[U,b.value.minPriceMovePct,void 0,{number:!0}]])]),e("label",ft,[t[33]||(t[33]=e("span",{class:"w-28 text-neutral-500"},"fee rate",-1)),D(e("input",{class:"inp w-full",type:"number",min:"0",step:"0.0001","onUpdate:modelValue":t[8]||(t[8]=o=>b.value.feeRate=o)},null,512),[[U,b.value.feeRate,void 0,{number:!0}]])]),e("label",vt,[t[34]||(t[34]=e("span",{class:"w-28 text-neutral-500"},"take profit %",-1)),D(e("input",{class:"inp w-full",type:"number",min:"0.001",step:"0.001","onUpdate:modelValue":t[9]||(t[9]=o=>b.value.takeProfitPct=o)},null,512),[[U,b.value.takeProfitPct,void 0,{number:!0}]])]),e("label",mt,[t[35]||(t[35]=e("span",{class:"w-28 text-neutral-500"},"trail %",-1)),D(e("input",{class:"inp w-full",type:"number",min:"0",step:"0.001","onUpdate:modelValue":t[10]||(t[10]=o=>b.value.trailingTakeProfitPct=o)},null,512),[[U,b.value.trailingTakeProfitPct,void 0,{number:!0}]])]),e("label",ht,[t[36]||(t[36]=e("span",{class:"w-28 text-neutral-500"},"max holding bars",-1)),D(e("input",{class:"inp w-full",type:"number",min:"0",step:"1","onUpdate:modelValue":t[11]||(t[11]=o=>b.value.maxHoldingBars=o)},null,512),[[U,b.value.maxHoldingBars,void 0,{number:!0}]])]),e("label",bt,[t[37]||(t[37]=e("span",{class:"w-28 text-neutral-500"},"label",-1)),D(e("input",{class:"inp w-full",type:"text","onUpdate:modelValue":t[12]||(t[12]=o=>te.value=o),placeholder:"e.g. test run"},null,512),[[U,te.value]])])]),e("div",gt,[e("button",{class:"btn-xs",onClick:n,disabled:!g(s).candles.length},"Simulate",8,xt),e("button",{class:"btn-xs",onClick:Q,disabled:l.value||!f.value.trades.length},"Save",8,yt),f.value.closed?(k(),R("span",_t,"TP hit · ROI "+v(W.value)+" · Fees "+v(f.value.totalFees.toFixed(4)),1)):f.value.trades.length?(k(),R("span",wt,"Open · legs "+v(G.value)+" / "+v(b.value.maxLegs)+" · entry "+v(((M=f.value.avgEntry)==null?void 0:M.toFixed(6))??"-"),1)):H("",!0),m.value?(k(),R("span",{key:2,class:le(["text-[10px]",a.value?"text-emerald-400":"text-rose-400"])},v(m.value),3)):H("",!0)]),e("div",kt,[e("table",Pt,[t[39]||(t[39]=e("thead",{class:"text-neutral-400"},[e("tr",null,[e("th",{class:"text-left font-normal p-1 border-b border-neutral-700/60"},"Time"),e("th",{class:"text-left font-normal p-1 border-b border-neutral-700/60"},"Side"),e("th",{class:"text-right font-normal p-1 border-b border-neutral-700/60"},"Price"),e("th",{class:"text-right font-normal p-1 border-b border-neutral-700/60"},"Qty"),e("th",{class:"text-right font-normal p-1 border-b border-neutral-700/60"},"Notional"),e("th",{class:"text-right font-normal p-1 border-b border-neutral-700/60"},"Fee"),e("th",{class:"text-left font-normal p-1 border-b border-neutral-700/60"},"Note")])],-1)),e("tbody",null,[(k(!0),R(ce,null,pe(f.value.trades,(o,w)=>(k(),R("tr",{key:w,class:"hover:bg-neutral-800/40"},[e("td",Ct,v(new Date(o.time).toLocaleString()),1),e("td",{class:le(["p-1",o.side==="buy"?"text-emerald-300":"text-rose-300"])},v(o.side),3),e("td",Rt,v(o.price.toFixed(6)),1),e("td",St,v(o.qty.toFixed(6)),1),e("td",Ot,v(o.notional.toFixed(4)),1),e("td",Bt,v(o.fee.toFixed(4)),1),e("td",Mt,v(o.note||""),1)]))),128)),f.value.trades.length?H("",!0):(k(),R("tr",zt,[...t[38]||(t[38]=[e("td",{class:"p-2 text-neutral-500",colspan:"7"},"no trades yet",-1)])]))])])])]),e("div",Lt,[e("div",At,[t[41]||(t[41]=e("h2",{class:"title mb-0"},"Saved Sims",-1)),e("div",Ft,[e("button",{class:"btn-xs",onClick:re,disabled:ee.value},"Refresh",8,Tt),ee.value?(k(),R("span",Et,"loading…")):H("",!0)])]),e("div",It,[e("table",Dt,[t[43]||(t[43]=e("thead",{class:"text-neutral-400"},[e("tr",null,[e("th",{class:"text-left font-normal p-1 border-b border-neutral-700/60"},"#"),e("th",{class:"text-left font-normal p-1 border-b border-neutral-700/60"},"When"),e("th",{class:"text-left font-normal p-1 border-b border-neutral-700/60"},"Label"),e("th",{class:"text-right font-normal p-1 border-b border-neutral-700/60"},"Legs"),e("th",{class:"text-right font-normal p-1 border-b border-neutral-700/60"},"ROI"),e("th",{class:"text-right font-normal p-1 border-b border-neutral-700/60"},"Action")])],-1)),e("tbody",null,[(k(!0),R(ce,null,pe(Z.value,o=>{var w;return k(),R("tr",{key:o.id,class:le(["hover:bg-neutral-800/40",ne.value===o.id?"bg-neutral-800/60":""]),onClick:ge=>he(o)},[e("td",Ut,v(o.id),1),e("td",Nt,v(new Date((o.created_ts||0)*1e3).toLocaleString()),1),e("td",$t,v(o.label||"-"),1),e("td",Wt,v(be(o.trades)),1),e("td",jt,v(((w=o.summary)==null?void 0:w.realizedRoi)!=null?(o.summary.realizedRoi*100).toFixed(2)+"%":"-"),1),e("td",qt,[e("button",{class:"btn-xs",onClick:Re(ge=>me(o.id),["stop"])},"Load",8,Gt)])],10,Vt)}),128)),Z.value.length?H("",!0):(k(),R("tr",Qt,[...t[42]||(t[42]=[e("td",{class:"p-2 text-neutral-500",colspan:"6"},"no saved sims",-1)])]))])])])])])])])}}}),Zt=Oe(Ht,[["__scopeId","data-v-048f5c2c"]]);export{Zt as default};
