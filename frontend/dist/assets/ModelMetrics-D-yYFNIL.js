import{d as D,k as b,c as w,l as U,m as L,G as O,o as j,a as m,b as t,i as C,p as F,v as q,t as o,q as z,z as h,A as N,f as k,F as G,r as J,n as P,e as p}from"./index-BtrOmqR2.js";import R from"./http-CilSfrpq.js";const W={class:"space-y-6"},$={class:"card"},H={class:"flex items-center justify-between mb-2"},K={class:"flex items-center gap-3 text-xs"},Q={class:"flex items-center gap-1"},X={class:"flex items-center gap-1"},Y=["disabled"],Z={class:"grid grid-cols-2 md:grid-cols-5 gap-4 mt-4 text-sm"},ee={class:"mt-6"},te={class:"font-semibold mb-2 text-sm"},le={class:"overflow-x-auto"},se={class:"w-full text-xs md:text-sm"},ae={class:"py-1 pr-3"},re={class:"py-1 pr-3"},ne={class:"py-1 pr-3"},oe={class:"py-1 pr-3"},ue={key:0,class:"ml-1 text-[10px] px-1 rounded bg-neutral-600/40 text-neutral-300"},ie=["title"],ce={key:0},de={class:"mt-4 text-xs text-neutral-400 flex flex-wrap gap-4"},ve={key:0},_e=D({__name:"ModelMetrics",setup(me){var M;const r=b([]),f=b(!1),u=b(!0),i=b(15);let c=null;const S=b(null),d=w(()=>r.value[r.value.length-1]),V=w(()=>[...r.value].sort((l,e)=>l.ts-e.ts)),E=w(()=>{if(r.value.length<2)return!1;const l=d.value,e=r.value[0];return!(l!=null&&l.ece)||!(e!=null&&e.ece)?!1:l.ece-e.ece>.02});function _(l){return l==null||Number.isNaN(l)?"-":typeof l=="number"?l.toFixed(3):String(l)}function y(l,e){const s=new RegExp(`^${e}(?:\\{[^}]*\\})?\\s+([-+]?((?:\\d*\\.\\d+)|(?:\\d+))(?:[eE][-+]?\\d+)?)`,"m"),a=l.match(s);if(!a)return null;const x=parseFloat(a[1]);return Number.isNaN(x)?null:x}function I(l){if(l==null||Number.isNaN(l))return"-";const e=Number(l);if(!Number.isFinite(e))return String(l);if(e>1e12)try{return new Date(e).toLocaleString()}catch{return String(e)}if(e>1e9)try{return new Date(e*1e3).toLocaleString()}catch{return String(e)}return String(e)}try{const l=localStorage.getItem("model_metrics_history_v1");if(l){const a=JSON.parse(l);Array.isArray(a)&&(r.value=a.slice(-200))}const e=localStorage.getItem("model_metrics_auto");(e==="true"||e==="false")&&(u.value=e==="true");const s=localStorage.getItem("model_metrics_interval");if(s!=null){const a=Number(s);!Number.isNaN(a)&&a>=5&&a<=300&&(i.value=a)}r.value.length&&(S.value=((M=r.value[r.value.length-1])==null?void 0:M.ts)??null)}catch{}async function v(){try{f.value=!0;const e=(await R.get("/metrics",{responseType:"text"})).data,s={ts:Date.now(),auc:y(e,"model_production_auc"),accuracy:y(e,"model_production_accuracy"),brier:y(e,"model_production_brier"),ece:y(e,"model_production_ece"),version:y(e,"model_production_version_timestamp"),ece_delta:null},a=r.value[0];a&&a.ece!==null&&s.ece!==null&&(s.ece_delta=s.ece-a.ece),r.value.push(s),r.value.length>200&&r.value.shift(),S.value=s.ts;try{localStorage.setItem("model_metrics_history_v1",JSON.stringify(r.value))}catch{}}catch(l){console.error(l)}finally{f.value=!1}}function T(){v()}U([u,i],()=>{c&&clearInterval(c);try{localStorage.setItem("model_metrics_auto",String(u.value))}catch{}try{localStorage.setItem("model_metrics_interval",String(i.value))}catch{}u.value&&(v(),c=setInterval(v,i.value*1e3))}),L(()=>{v(),u.value&&(c=setInterval(v,i.value*1e3))}),O(()=>{u.value&&!f.value&&v()}),j(()=>{c&&clearInterval(c),c=null});const g=D({name:"MetricBox",props:{label:{type:String,required:!0},value:{type:[Number,String,null],default:null},warn:{type:Boolean,default:!1}},setup(l){return{display:w(()=>{const s=l.value;return s==null||Number.isNaN(s)?"-":typeof s=="number"?s.toFixed(3):String(s)})}},template:`<div class='p-3 rounded bg-neutral-700/40 flex flex-col justify-between'><div class='text-neutral-400 text-xs'>{{ label }}</div><div :class="'font-semibold ' + (warn ? 'text-brand-danger':'')">{{ display }}</div></div>`});return(l,e)=>{var s,a,x,B,A;return p(),m("div",W,[t("section",$,[t("div",H,[e[4]||(e[4]=t("h1",{class:"text-xl font-semibold"},"Model Metrics",-1)),t("div",K,[t("label",Q,[e[2]||(e[2]=C("간격 ",-1)),F(t("input",{type:"range",min:"5",max:"60","onUpdate:modelValue":e[0]||(e[0]=n=>i.value=n)},null,512),[[q,i.value,void 0,{number:!0}]]),t("span",null,o(i.value)+"s",1)]),t("label",X,[F(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=n=>u.value=n)},null,512),[[z,u.value]]),e[3]||(e[3]=C(" 자동 ",-1))]),t("button",{class:"btn",onClick:T,disabled:f.value},"새로고침",8,Y)])]),e[7]||(e[7]=t("p",{class:"text-sm text-neutral-300"},"프로덕션 모델 지표 (Prometheus /metrics 파싱)",-1)),t("div",Z,[h(N(g),{label:"AUC",value:(s=d.value)==null?void 0:s.auc},null,8,["value"]),h(N(g),{label:"Accuracy",value:(a=d.value)==null?void 0:a.accuracy},null,8,["value"]),h(N(g),{label:"Brier",value:(x=d.value)==null?void 0:x.brier},null,8,["value"]),h(N(g),{label:"ECE",value:(B=d.value)==null?void 0:B.ece,warn:E.value},null,8,["value","warn"]),h(N(g),{label:"Version",value:I((A=d.value)==null?void 0:A.version)},null,8,["value"])]),t("div",ee,[t("h2",te,"Trend (최근 "+o(r.value.length)+"개)",1),t("div",le,[t("table",se,[e[6]||(e[6]=t("thead",{class:"text-neutral-400 text-left"},[t("tr",null,[t("th",{class:"py-1 pr-3"},"Time"),t("th",{class:"py-1 pr-3"},"AUC"),t("th",{class:"py-1 pr-3"},"ACC"),t("th",{class:"py-1 pr-3"},"Brier"),t("th",{class:"py-1 pr-3"},"ECE"),t("th",{class:"py-1 pr-3"},"Version")])],-1)),t("tbody",null,[(p(!0),m(G,null,J(V.value,n=>(p(),m("tr",{key:n.ts,class:"border-t border-neutral-700/40"},[t("td",ae,o(new Date(n.ts).toLocaleTimeString()),1),t("td",re,o(_(n.auc)),1),t("td",ne,o(_(n.accuracy)),1),t("td",oe,o(_(n.brier)),1),t("td",{class:P(["py-1 pr-3",n.ece_delta&&n.ece_delta>0?"text-brand-danger":""])},[C(o(_(n.ece))+" ",1),n.ece_delta!==null?(p(),m("span",ue,"Δ "+o(_(n.ece_delta)),1)):k("",!0)],2),t("td",{class:"py-1 pr-3",title:String(n.version??"")},o(I(n.version)),9,ie)]))),128)),!f.value&&r.value.length===0?(p(),m("tr",ce,[...e[5]||(e[5]=[t("td",{colspan:"6",class:"py-3 text-center text-neutral-400"},"데이터 없음",-1)])])):k("",!0)])])])]),t("div",de,[S.value?(p(),m("div",ve,"갱신: "+o(new Date(S.value).toLocaleTimeString()),1)):k("",!0),t("div",null,"자동: "+o(u.value?"ON":"OFF"),1)])])])}}});export{_e as default};
