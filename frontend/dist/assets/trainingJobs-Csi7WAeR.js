import{j as R,k as r,c as k}from"./index-BtrOmqR2.js";import q from"./http-CilSfrpq.js";const K=R("trainingJobs",()=>{const v=r([]),m=r(!1),g=r(null),o=r(!0),_=r(10),h=r(100);let c=null;const f=r("created_at"),l=r("desc"),w=r(Date.now());let u=null;const p=r("all"),b=r("all");function x(e){if(!e)return 0;if(/^\d+(?:\.\d+)?$/.test(e))return parseFloat(e)*1e3;const a=new Date(e).getTime();return isNaN(a)?0:a}function y(e){const a=x(e.created_at);if(typeof e.duration_seconds=="number"&&!isNaN(e.duration_seconds))return Math.max(0,e.duration_seconds*1e3);const t=e.finished_at?x(e.finished_at):null;return t&&t>0&&t>=a?Math.max(0,t-a):e.status==="running"?Math.max(0,w.value-a):0}function M(e){if(!e)return"other";const a=String(e).toLowerCase();return a.includes("drift")||a==="drift_auto"?"auto":a.includes("manual")?"manual":"other"}const C=k(()=>{const e=v.value.filter(a=>{if(p.value!=="all"&&a.status!==p.value)return!1;if(b.value!=="all"){const t=M(a.trigger);if(b.value!==t)return!1}return!0});return e.sort((a,t)=>{var T,D;const n=f.value;let i,s;return n==="auc"||n==="accuracy"||n==="brier"||n==="ece"?(i=(T=a.metrics)==null?void 0:T[n],s=(D=t.metrics)==null?void 0:D[n]):n==="duration"?(i=y(a),s=y(t)):(i=a[n],s=t[n]),i==null&&(i=-1/0),s==null&&(s=-1/0),i<s?l.value==="asc"?-1:1:i>s?l.value==="asc"?1:-1:0}),e});function J(e){switch(e){case"running":return"text-amber-400";case"success":return"text-brand-accent";case"error":return"text-brand-danger";default:return"text-neutral-400"}}async function d(){try{m.value=!0,g.value=null;const e=await q.get(`/api/training/jobs?limit=${encodeURIComponent(h.value)}`).catch(t=>({data:[]})),a=Array.isArray(e.data)?e.data:[];v.value=a.map(t=>({id:t.id,status:t.status,trigger:t.trigger,created_at:t.created_at,finished_at:t.finished_at??null,duration_seconds:t.duration_seconds??null,artifact_path:t.artifact_path,model_id:t.model_id,version:t.version,metrics:t.metrics,drift_feature:t.drift_feature,drift_z:t.drift_z,error:t.error}))}catch(e){console.warn("[trainingJobs] fetch failed",e),g.value=e.__friendlyMessage||e.message||"fetch failed"}finally{m.value=!1}}function I(){if(S(),u&&clearInterval(u),u=setInterval(()=>{w.value=Date.now()},1e3),o.value){let e=2;const a=setInterval(async()=>{await d(),e-=1,e<=0&&(clearInterval(a),c=setInterval(d,_.value*1e3))},2e3)}}function S(){c&&clearInterval(c),c=null,u&&clearInterval(u),u=null}function N(e){typeof e=="boolean"?o.value=e:o.value=!o.value,I()}function z(e){_.value=e,I()}function A(e){h.value=e,d()}function F(e){f.value===e?l.value=l.value==="asc"?"desc":"asc":(f.value=e,l.value=e==="created_at"?"desc":"asc")}return{jobs:v,filteredSorted:C,loading:m,error:g,auto:o,intervalSec:_,fetchJobs:d,start:I,stop:S,toggleAuto:N,setIntervalSec:z,statusColor:J,sortKey:f,sortDir:l,setSort:F,jobDurationMs:y,limit:h,setLimit:A,statusFilter:p,triggerFilter:b}});export{K as u};
